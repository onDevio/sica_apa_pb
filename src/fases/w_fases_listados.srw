HA$PBExportHeader$w_fases_listados.srw
forward
global type w_fases_listados from w_listados
end type
type tab_1 from tab within w_fases_listados
end type
type tabpage_1 from userobject within tab_1
end type
type lb_1 from listbox within tabpage_1
end type
type st_1 from statictext within tabpage_1
end type
type dw_pem_hono from u_dw within tabpage_1
end type
type dw_principal from u_dw within tabpage_1
end type
type tabpage_1 from userobject within tab_1
lb_1 lb_1
st_1 st_1
dw_pem_hono dw_pem_hono
dw_principal dw_principal
end type
type tabpage_5 from userobject within tab_1
end type
type dw_minutas from u_dw within tabpage_5
end type
type tabpage_5 from userobject within tab_1
dw_minutas dw_minutas
end type
type tabpage_9 from userobject within tab_1
end type
type cb_borrar3_est from commandbutton within tabpage_9
end type
type cb_todos3_est from commandbutton within tabpage_9
end type
type cb_borrar2_est from commandbutton within tabpage_9
end type
type cb_todos2_est from commandbutton within tabpage_9
end type
type cb_borrar1_est from commandbutton within tabpage_9
end type
type cb_todos1_est from commandbutton within tabpage_9
end type
type dw_destino_seleccion from u_dw within tabpage_9
end type
type dw_destino from u_dw within tabpage_9
end type
type dw_tipoobra from u_dw within tabpage_9
end type
type dw_tipoact from u_dw within tabpage_9
end type
type dw_tipo_obra_seleccion from u_dw within tabpage_9
end type
type dw_tipo_actuacion_seleccion from u_dw within tabpage_9
end type
type gb_1 from groupbox within tabpage_9
end type
type gb_9 from groupbox within tabpage_9
end type
type gb_11 from groupbox within tabpage_9
end type
type tabpage_9 from userobject within tab_1
cb_borrar3_est cb_borrar3_est
cb_todos3_est cb_todos3_est
cb_borrar2_est cb_borrar2_est
cb_todos2_est cb_todos2_est
cb_borrar1_est cb_borrar1_est
cb_todos1_est cb_todos1_est
dw_destino_seleccion dw_destino_seleccion
dw_destino dw_destino
dw_tipoobra dw_tipoobra
dw_tipoact dw_tipoact
dw_tipo_obra_seleccion dw_tipo_obra_seleccion
dw_tipo_actuacion_seleccion dw_tipo_actuacion_seleccion
gb_1 gb_1
gb_9 gb_9
gb_11 gb_11
end type
type tabpage_2 from userobject within tab_1
end type
type cb_todos7 from commandbutton within tabpage_2
end type
type cb_todos4 from commandbutton within tabpage_2
end type
type gb_12 from groupbox within tabpage_2
end type
type gb_estados from groupbox within tabpage_2
end type
type gb_gestion from groupbox within tabpage_2
end type
type gb_modalidad from groupbox within tabpage_2
end type
type dw_modalidad_contrato from u_dw within tabpage_2
end type
type dw_gestion_contrato from u_dw within tabpage_2
end type
type dw_estados_contrato from u_dw within tabpage_2
end type
type dw_seleccion_estados from u_dw within tabpage_2
end type
type cb_todos1 from commandbutton within tabpage_2
end type
type cb_borrar1 from commandbutton within tabpage_2
end type
type dw_seleccion_gestion from u_dw within tabpage_2
end type
type dw_seleccion_modalidad from u_dw within tabpage_2
end type
type cb_todos2 from commandbutton within tabpage_2
end type
type cb_borrar2 from commandbutton within tabpage_2
end type
type cb_todos3 from commandbutton within tabpage_2
end type
type cb_borrar3 from commandbutton within tabpage_2
end type
type dw_consulta_col_destino from u_dw within tabpage_2
end type
type dw_seleccion_col_destino from u_dw within tabpage_2
end type
type tabpage_2 from userobject within tab_1
cb_todos7 cb_todos7
cb_todos4 cb_todos4
gb_12 gb_12
gb_estados gb_estados
gb_gestion gb_gestion
gb_modalidad gb_modalidad
dw_modalidad_contrato dw_modalidad_contrato
dw_gestion_contrato dw_gestion_contrato
dw_estados_contrato dw_estados_contrato
dw_seleccion_estados dw_seleccion_estados
cb_todos1 cb_todos1
cb_borrar1 cb_borrar1
dw_seleccion_gestion dw_seleccion_gestion
dw_seleccion_modalidad dw_seleccion_modalidad
cb_todos2 cb_todos2
cb_borrar2 cb_borrar2
cb_todos3 cb_todos3
cb_borrar3 cb_borrar3
dw_consulta_col_destino dw_consulta_col_destino
dw_seleccion_col_destino dw_seleccion_col_destino
end type
type tabpage_7 from userobject within tab_1
end type
type dw_otros_doc_contrato from u_dw within tabpage_7
end type
type dw_otros_docs from u_dw within tabpage_7
end type
type tabpage_7 from userobject within tab_1
dw_otros_doc_contrato dw_otros_doc_contrato
dw_otros_docs dw_otros_docs
end type
type tabpage_6 from userobject within tab_1
end type
type dw_pagos_plataforma from u_dw within tabpage_6
end type
type dw_renuncias from u_csd_dw within tabpage_6
end type
type dw_registro_es from u_dw within tabpage_6
end type
type dw_reparos from u_dw within tabpage_6
end type
type dw_reclamaciones from u_dw within tabpage_6
end type
type dw_garantias from u_dw within tabpage_6
end type
type dw_final_obra from u_dw within tabpage_6
end type
type tabpage_6 from userobject within tab_1
dw_pagos_plataforma dw_pagos_plataforma
dw_renuncias dw_renuncias
dw_registro_es dw_registro_es
dw_reparos dw_reparos
dw_reclamaciones dw_reclamaciones
dw_garantias dw_garantias
dw_final_obra dw_final_obra
end type
type tabpage_8 from userobject within tab_1
end type
type dw_arquitectos from u_dw within tabpage_8
end type
type tabpage_8 from userobject within tab_1
dw_arquitectos dw_arquitectos
end type
type tabpage_3 from userobject within tab_1
end type
type dw_datos_agrupacion from u_dw within tabpage_3
end type
type dw_opcion_agr from u_dw within tabpage_3
end type
type dw_opcion_sit from u_dw within tabpage_3
end type
type dw_opcion_incomp from u_dw within tabpage_3
end type
type dw_agrupaciones from u_dw within tabpage_3
end type
type dw_sit_profesionales from u_dw within tabpage_3
end type
type dw_incompatibilidades from u_dw within tabpage_3
end type
type cb_incluir4 from commandbutton within tabpage_3
end type
type cb_borrar4 from commandbutton within tabpage_3
end type
type cb_3 from commandbutton within tabpage_3
end type
type cb_4 from commandbutton within tabpage_3
end type
type cb_5 from commandbutton within tabpage_3
end type
type cb_6 from commandbutton within tabpage_3
end type
type dw_datos_sitprof from u_dw within tabpage_3
end type
type gb_7 from groupbox within tabpage_3
end type
type gb_6 from groupbox within tabpage_3
end type
type gb_5 from groupbox within tabpage_3
end type
type gb_4 from groupbox within tabpage_3
end type
type gb_8 from groupbox within tabpage_3
end type
type tabpage_3 from userobject within tab_1
dw_datos_agrupacion dw_datos_agrupacion
dw_opcion_agr dw_opcion_agr
dw_opcion_sit dw_opcion_sit
dw_opcion_incomp dw_opcion_incomp
dw_agrupaciones dw_agrupaciones
dw_sit_profesionales dw_sit_profesionales
dw_incompatibilidades dw_incompatibilidades
cb_incluir4 cb_incluir4
cb_borrar4 cb_borrar4
cb_3 cb_3
cb_4 cb_4
cb_5 cb_5
cb_6 cb_6
dw_datos_sitprof dw_datos_sitprof
gb_7 gb_7
gb_6 gb_6
gb_5 gb_5
gb_4 gb_4
gb_8 gb_8
end type
type tabpage_4 from userobject within tab_1
end type
type dw_opcion_situaciones from u_dw within tabpage_4
end type
type dw_alta_si_no from u_dw within tabpage_4
end type
type dw_situaciones from u_dw within tabpage_4
end type
type dw_t_alta from u_dw within tabpage_4
end type
type dw_opcion_bajas from u_dw within tabpage_4
end type
type cb_todos10 from commandbutton within tabpage_4
end type
type cb_borrar10 from commandbutton within tabpage_4
end type
type cb_todos20 from commandbutton within tabpage_4
end type
type cb_borrar20 from commandbutton within tabpage_4
end type
type cb_todos30 from commandbutton within tabpage_4
end type
type cb_borrar30 from commandbutton within tabpage_4
end type
type dw_opcion_altas from u_dw within tabpage_4
end type
type dw_t_baja from u_dw within tabpage_4
end type
type gb_2 from groupbox within tabpage_4
end type
type gb_10 from groupbox within tabpage_4
end type
type gb_3 from groupbox within tabpage_4
end type
type tabpage_4 from userobject within tab_1
dw_opcion_situaciones dw_opcion_situaciones
dw_alta_si_no dw_alta_si_no
dw_situaciones dw_situaciones
dw_t_alta dw_t_alta
dw_opcion_bajas dw_opcion_bajas
cb_todos10 cb_todos10
cb_borrar10 cb_borrar10
cb_todos20 cb_todos20
cb_borrar20 cb_borrar20
cb_todos30 cb_todos30
cb_borrar30 cb_borrar30
dw_opcion_altas dw_opcion_altas
dw_t_baja dw_t_baja
gb_2 gb_2
gb_10 gb_10
gb_3 gb_3
end type
type tabpage_10 from userobject within tab_1
end type
type dw_opcion_residente from u_dw within tabpage_10
end type
type dw_residente from u_dw within tabpage_10
end type
type cb_borrar5 from commandbutton within tabpage_10
end type
type cb_todos5 from commandbutton within tabpage_10
end type
type gb_15 from groupbox within tabpage_10
end type
type tabpage_10 from userobject within tab_1
dw_opcion_residente dw_opcion_residente
dw_residente dw_residente
cb_borrar5 cb_borrar5
cb_todos5 cb_todos5
gb_15 gb_15
end type
type tabpage_11 from userobject within tab_1
end type
type cb_todos6 from commandbutton within tabpage_11
end type
type cb_borrar6 from commandbutton within tabpage_11
end type
type dw_honos_tarifas from u_dw within tabpage_11
end type
type dw_opcion_tarifa from u_dw within tabpage_11
end type
type gb_16 from groupbox within tabpage_11
end type
type tabpage_11 from userobject within tab_1
cb_todos6 cb_todos6
cb_borrar6 cb_borrar6
dw_honos_tarifas dw_honos_tarifas
dw_opcion_tarifa dw_opcion_tarifa
gb_16 gb_16
end type
type tab_1 from tab within w_fases_listados
tabpage_1 tabpage_1
tabpage_5 tabpage_5
tabpage_9 tabpage_9
tabpage_2 tabpage_2
tabpage_7 tabpage_7
tabpage_6 tabpage_6
tabpage_8 tabpage_8
tabpage_3 tabpage_3
tabpage_4 tabpage_4
tabpage_10 tabpage_10
tabpage_11 tabpage_11
end type
type cb_1 from commandbutton within w_fases_listados
end type
end forward

global type w_fases_listados from w_listados
integer width = 3890
integer height = 2532
string title = "Listados de Contratos"
event csd_consulta_arquitectos ( )
event csd_consulta_colegiado ( )
event csd_consulta_colegiado_col ( )
event csd_consulta_control ( )
event csd_consulta_finales_obra ( )
event csd_consulta_garantias ( )
event csd_consulta_minutas ( )
event csd_consulta_otros_documentos ( )
event csd_consulta_pem_hono ( )
event csd_consulta_principal ( )
event csd_consulta_reclamaciones ( )
event csd_consulta_registros ( )
event csd_consulta_reparos ( )
event csd_consulta_residente ( )
event csd_oculta ( )
event csd_consulta_estadistica ( )
event csd_consulta_tarifas ( )
event csd_consulta_renuncia ( )
event consulta_pagos_plataforma ( )
tab_1 tab_1
cb_1 cb_1
end type
global w_fases_listados w_fases_listados

type variables
u_dw idw_principal, idw_estados_contrato, idw_gestion_contrato, idw_modalidad_contrato
u_dw idw_datos_agrupacion, idw_datos_sitprof, idw_agrupaciones, idw_sit_profesionales
u_dw idw_incompatibilidades, idw_alta_si_no, idw_opcion_situaciones, idw_opcion_bajas
u_dw idw_situaciones, idw_t_alta, idw_t_baja, idw_opcion_altas
u_dw idw_pem_hono, idw_renuncias, idw_colegio_dest, idw_seleccion_col_dest

u_dw idw_seleccion_estados, idw_seleccion_gestion, idw_seleccion_modalidad
u_dw idw_opcion_agr, idw_opcion_sit, idw_opcion_incomp
u_dw idw_minutas, idw_gestion_contrato_minutas, idw_final_obra, idw_garantias, idw_reclamaciones
u_dw idw_reparos, idw_registro_es, idw_otros_doc_contrato, idw_otros_docs, idw_arquitectos
u_dw idw_opcion_residente, idw_residente, idw_pagos_plataforma

u_dw idw_tipo_actuacion_seleccion, idw_tipo_obra_seleccion, idw_destino_seleccion
u_dw idw_tipoact, idw_tipoobra, idw_destino, idw_tarifas, idw_opcion_tarifas

string i_exp,i_reg,i_resultado,isql_nuevo
integer i_tab

st_fases_colegiados_sociedades ist_fases_col_soc 

boolean lb_is_not_initialized = false
end variables

forward prototypes
public subroutine wf_rellenar_listado (datawindow dw)
end prototypes

event csd_consulta_arquitectos();string sql_aux,sql_aux2='', nombre, apellidos
int i

idw_arquitectos.AcceptText()

nombre 		= idw_arquitectos.GetItemstring(1,'nombre')
apellidos	= idw_arquitectos.GetItemstring(1,'apellidos')

if (not isnull(nombre)) or (not isnull(apellidos) ) then
	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_arquitectos.id_fase )'})
else
	return
end if

if (not isnull(nombre))  then isql_nuevo +=  " and ( fases_arquitectos.nombre like '" + nombre + "%')"
if (not isnull(apellidos))  then isql_nuevo +=  " and ( fases_arquitectos.apellidos like '" + apellidos + "%')"


//string sql_aux,sql_aux2='', nombre, apellidos
//int i
//
//idw_arquitectos.AcceptText()
//
//nombre 		= idw_arquitectos.GetItemstring(1,'nombre')
//apellidos	= idw_arquitectos.GetItemstring(1,'apellidos')
//
//if not isnull(nombre) then sql_aux2= sql_aux2 + " and (fases.id_fase IN (SELECT id_fase from fases_arquitectos where nombre like '" + nombre + "%')" + /*sql_aux2*/ +')'
//if not isnull(apellidos) then sql_aux2= sql_aux2 + " and (fases.id_fase IN (SELECT id_fase from fases_arquitectos where apellidos like '" + apellidos + "%')" + /*sql_aux2*/ +')'
//
//if not(f_es_vacio(sql_aux2)) then
//	if pos(upper(isql_nuevo), "WHERE") > 0  then
//		sql_aux =  sql_aux2
//		//sql_aux = 'and ' + sql_aux2
//	else
//		sql_aux = "WHERE " + sql_aux2
//	end if	
//	if not isnull(sql_aux) then isql_nuevo += sql_aux
//end if
end event

event csd_consulta_colegiado();boolean coma
string codigos,sql_aux,operador,opcion
string alta,sql_aux2=''
datetime df_inicio,hf_inicio,df_fin,hf_fin
int i

idw_datos_agrupacion.AcceptText()

df_inicio 	= idw_datos_agrupacion.GetItemDatetime(1,'df_inicio')
df_fin 		= idw_datos_agrupacion.GetItemDatetime(1,'df_fin')
hf_inicio 	= idw_datos_agrupacion.GetItemDatetime(1,'hf_inicio')
hf_fin 		= idw_datos_agrupacion.GetItemDatetime(1,'hf_fin')

if not isnull(df_inicio) then sql_aux= sql_aux + " and agrupaciones.f_inicio>='"+string(date(df_inicio),'yyyymmdd')+"'"
if not isnull(hf_inicio) then sql_aux= sql_aux + " and agrupaciones.f_inicio<='"+string(date(hf_inicio),'yyyymmdd')+"'"
if not isnull(df_fin) then sql_aux= sql_aux + " and agrupaciones.f_fin>='"+string(date(df_fin),'yyyymmdd')+"'"
if not isnull(hf_fin) then sql_aux= sql_aux + " and agrupaciones.f_fin<='"+string(date(hf_fin),'yyyymmdd')+"'"

//Todos los colegiados que pertenezcan a las agrupaciones elegidas, ya q se pueden elegir varias de una lista
coma=false
opcion = idw_opcion_agr.GetItemString(1,'opcion')
if opcion<>'%' then
	for i=1 to idw_agrupaciones.RowCount()
		if idw_agrupaciones.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_agrupaciones.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
end if

if sql_aux <> '' or codigos <> '' then
	isql_nuevo = f_sql_join(isql_nuevo, {'( colegiados.id_colegiado = agrupaciones.id_colegiado )'})
	isql_nuevo += sql_aux
	if codigos <> '' then isql_nuevo += ' and agrupaciones.agrupacion IN ( '+codigos+')'
end if

//Incompatibilidades
string pob,org
sql_aux=''
pob = idw_datos_sitprof.GetItemString(1,'poblacion')
org = idw_datos_sitprof.GetItemString(1,'organismo')
df_inicio 	= idw_datos_sitprof.GetItemDatetime(1,'df_inicio')
df_fin 		= idw_datos_sitprof.GetItemDatetime(1,'df_fin')
hf_inicio 	= idw_datos_sitprof.GetItemDatetime(1,'hf_inicio')
hf_fin 		= idw_datos_sitprof.GetItemDatetime(1,'hf_fin')

if not f_es_vacio(pob) then sql_aux= sql_aux + " and incompatibilidades.cod_pob like '"+pob+"%'"
if not f_es_vacio(org) then sql_aux= sql_aux + " and incompatibilidades.organismo like'"+org+"%'"
if not isnull(df_inicio) then sql_aux= sql_aux + " and incompatibilidades.fecha_inicio>='"+string(date(df_inicio),'yyyymmdd')+"'"
if not isnull(hf_inicio) then sql_aux= sql_aux + " and incompatibilidades.fecha_inicio<'"+string(date(hf_inicio),'yyyymmdd')+"'"
if not isnull(df_fin) then sql_aux= sql_aux + " and incompatibilidades.fecha_fin>='"+string(date(df_fin),'yyyymmdd')+"'"
if not isnull(hf_fin) then sql_aux= sql_aux + " and incompatibilidades.fecha_fin<'"+string(date(hf_fin),'yyyymmdd')+"'"

//Todos los colegiados que pertenezcan a las Situaciones Profesionales elegidas, ya q se pueden elegir varias de una lista
string codigos_sitprof
opcion = idw_opcion_sit.GetItemString(1,'opcion')
coma=false
if opcion<>'%' then
	for i=1 to idw_sit_profesionales.RowCount()
		if idw_sit_profesionales.GetItemString(i,'activo') = 'S' then
			if coma then codigos_sitprof= codigos_sitprof+','
			codigos_sitprof = codigos_sitprof+"'"+idw_sit_profesionales.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
end if

//Todos los colegiados que Tengan las Incompatibilidades elegidas, ya q se pueden elegir varias de una lista
string codigos_incomp
opcion = idw_opcion_incomp.GetItemString(1,'opcion')
if opcion<>'%' then
	coma=false
	for i=1 to idw_incompatibilidades.RowCount()
		if idw_incompatibilidades.GetItemString(i,'activo') = 'S' then
			if coma then codigos_incomp= codigos_incomp+','
			codigos_incomp = codigos_incomp+"'"+idw_incompatibilidades.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
end if
if sql_aux <> '' or codigos_sitprof <> '' or codigos_incomp <> '' then
	isql_nuevo = f_sql_join(isql_nuevo, {'colegiados.id_colegiado = incompatibilidades.id_colegiado'})
	isql_nuevo += sql_aux
	if codigos_sitprof <> '' then isql_nuevo += ' and incompatibilidades.tipo_situacion IN ( '+codigos_sitprof+')'
	if codigos_incomp <> '' then isql_nuevo += ' and incompatibilidades.tipo_incompatibilidad IN ( '+codigos_incomp+')'	
end if

end event

event csd_consulta_colegiado_col();string codigos,sql_aux,opcion,operador,alta
boolean coma
int i
//Todos los colegiados que pertenezcan a la situaci$$HEX1$$f300$$ENDHEX$$nes elegidas, ya q se pueden elegir varias de una lista

opcion = idw_opcion_sit.GetItemString(1,'opcion')
alta = idw_alta_si_no.GetItemString(1,'alta')
if alta<>'%' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and colegiados.alta_baja = '"+alta+"'"
		else
			sql_aux = "WHERE colegiados.alta_baja = '"+alta+"'"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
end if
if opcion<>'%'  then
	coma=false
	for i=1 to idw_situaciones.RowCount()
		if idw_situaciones.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_situaciones.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and colegiados.situacion "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE colegiados.situacion "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
end if

//Todos los colegiados que pertenezcan al tipo de alta elegido, ya q se pueden elegir varias de una lista
coma=false
codigos=''
opcion = 'S' //idw_opcion_altas.GetItemString(1,'opcion')

if opcion<>'%' and idw_alta_si_no.GetItemString(1,'alta')='S' then
	for i=1 to idw_t_alta.RowCount()
		if idw_t_alta.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_t_alta.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and colegiados.t_alta "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE colegiados.t_alta "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
end if

//Todos los colegiados que pertenezcan al tipo de baja elegido, ya q se pueden elegir varias de una lista
coma=false
codigos=''
opcion = 'S' //idw_opcion_bajas.GetItemString(1,'opcion')

if opcion<>'%' and idw_alta_si_no.GetItemString(1,'alta')='N' then
	for i=1 to idw_t_baja.RowCount()
		if idw_t_baja.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_t_baja.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and colegiados.t_baja "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE colegiados.t_baja "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
end if

end event

event csd_consulta_control();string codigos,sql_aux,opcion,operador,alta
boolean coma
int i


//Estados contrato
opcion = idw_seleccion_estados.GetItemString(1,'opcion')
if opcion<>'%' then 
	coma=false
	for i=1 to idw_estados_contrato.RowCount()
		if idw_estados_contrato.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_estados_contrato.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and fases.estado "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE fases.estado "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
end if

//Tipo_gestion contrato
coma=false
codigos=''
opcion = idw_seleccion_gestion.GetItemString(1,'opcion')
if opcion<>'%' then 
	for i=1 to idw_gestion_contrato.RowCount()
		if idw_gestion_contrato.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_gestion_contrato.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and fases.tipo_gestion "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE fases.tipo_gestion "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
end if
	
//Modalidad contrato
coma=false
codigos=''
opcion = idw_seleccion_modalidad.GetItemString(1,'opcion')
if opcion<>'%' then 
	for i=1 to idw_modalidad_contrato.RowCount()
		if idw_modalidad_contrato.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_modalidad_contrato.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and fases.modalidad "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE fases.modalidad "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if	
end if


//Colegio Destino
coma=false
codigos=''
opcion = idw_seleccion_col_dest.GetItemString(1,'opcion')
if opcion<>'%' then 
	for i=1 to idw_colegio_dest.RowCount()
		if idw_colegio_dest.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_colegio_dest.GetItemString(i,'cod_colegio')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and fases.cod_colegio_dest "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE fases.cod_colegio_dest "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if	
end if
end event

event csd_consulta_finales_obra();string sql_aux,sql_aux2='', tipo, web
datetime fechad, fechah, f_intro_d, f_intro_h
double presupuestod,presupuestoh
int i

idw_final_obra.AcceptText()

fechad 			= idw_final_obra.GetItemDatetime(1,'fechad')
fechah 			= idw_final_obra.GetItemDatetime(1,'fechah')
f_intro_d		= idw_final_obra.GetItemDatetime(1,'f_intro_d')
f_intro_h 		= idw_final_obra.GetItemDatetime(1,'f_intro_h')
presupuestod	= idw_final_obra.GetItemnumber(1,'presupuestod')
presupuestoh 	= idw_final_obra.GetItemnumber(1,'presupuestoh')
tipo		 		= idw_final_obra.GetItemstring(1,'tipo')
web			     = idw_final_obra.GetItemstring(1,'web')

if (not isnull(f_intro_d)) or (not isnull(f_intro_h)) or (not isnull(fechad)) or (not isnull(fechah)) or (not isnull(presupuestod)) or (not isnull(presupuestoh)) or ((not isnull(tipo)) AND (tipo <> '%' ))  or ((not isnull(web)) AND (web <> '%' ))   then
	isql_nuevo = f_sql_join(isql_nuevo, {'fases.id_fase = fases_finales.id_fase'})
end if

if not isnull(fechad) then isql_nuevo += " and ( fases_finales.fecha >='"+string(date(fechad),'yyyymmdd')+"')"
if not isnull(fechah) then isql_nuevo += " and ( fases_finales.fecha <='"+string(date(fechah),'yyyymmdd')+"')"
if not isnull(f_intro_d) then isql_nuevo += " and ( fases_finales.f_intro >='"+string(date(f_intro_d),'yyyymmdd')+"')"
if not isnull(f_intro_h) then isql_nuevo += " and ( fases_finales.f_intro <='"+string(date(f_intro_h),'yyyymmdd')+"')"
if not isnull(presupuestod) then isql_nuevo += " and ( fases_finales.presupuesto >="+string(presupuestod)+")"
if not isnull(presupuestoh) then isql_nuevo += " and ( fases_finales.presupuesto <="+string(presupuestoh)+")"
if not isnull(tipo) and tipo <> '%' then isql_nuevo += " and ( fases_finales.total_parcial like '"+tipo+"%')"
if not isnull(web) and web <> '%' then isql_nuevo += " and ( fases_finales.web like '"+web+"%')"
end event

event csd_consulta_garantias();string sql_aux,sql_aux2='', tipo
datetime fechad, fechah, fechafd, fechafh
double presupuestod,presupuestoh
int i

idw_garantias.AcceptText()

fechad 		= idw_garantias.GetItemDatetime(1,'fechad')
fechah 		= idw_garantias.GetItemDatetime(1,'fechah')
fechafd 		= idw_garantias.GetItemDatetime(1,'fechafd')
fechafh 		= idw_garantias.GetItemDatetime(1,'fechafh')
presupuestod		= idw_garantias.GetItemnumber(1,'presupuestod')
presupuestoh 	= idw_garantias.GetItemnumber(1,'presupuestoh')

if (not isnull(fechad)) or (not isnull(fechah)) or (not isnull(fechafd)) or (not isnull(fechafh)) or (not isnull(presupuestod)) or (not isnull(presupuestoh) ) then
	isql_nuevo = f_sql_join(isql_nuevo, {'fases.id_fase = fases_garantias.id_fase'})
end if

if not isnull(fechad) then isql_nuevo += " and ( fases_garantias.f_in >='"+string(date(fechad),'yyyymmdd')+"')"
if not isnull(fechah) then isql_nuevo += " and ( fases_garantias.f_in <='"+string(date(fechah),'yyyymmdd')+"')"
if not isnull(fechafd) then isql_nuevo += " and ( fases_garantias.f_out >='"+string(date(fechafd),'yyyymmdd')+"')"
if not isnull(fechafh) then isql_nuevo += " and ( fases_garantias.f_out <='"+string(date(fechafh),'yyyymmdd')+"')"
if not isnull(presupuestod) then isql_nuevo += " and ( fases_garantias.importe >="+string(presupuestod)+")"
if not isnull(presupuestoh) then isql_nuevo += " and ( fases_garantias. importe <="+string(presupuestoh)+")"


end event

event csd_consulta_minutas();boolean coma
string codigos,sql_aux,operador,opcion, tipo_gest
string n_aviso, pendiente, sql_aux2=''
datetime fechad, fechah, fecha_pagod,fecha_pagoh
double imported, importeh,honorariosd, honorariosh
int i
string ls_listado

idw_minutas.AcceptText()

n_aviso		= idw_minutas.GetItemString(1,'n_aviso')
imported		= idw_minutas.GetItemnumber(1,'imported')
importeh 	= idw_minutas.GetItemnumber(1,'importeh')
honorariosd	= idw_minutas.GetItemnumber(1,'honorariosd')
honorariosh	= idw_minutas.GetItemnumber(1,'honorariosh')
fechad 		= idw_minutas.GetItemDatetime(1,'fechad')
fechah 		= idw_minutas.GetItemDatetime(1,'fechah')
fecha_pagod = idw_minutas.GetItemDatetime(1,'fecha_pagod')
fecha_pagoh = idw_minutas.GetItemDatetime(1,'fecha_pagoh')
pendiente 	= idw_minutas.GetItemstring(1,'pendiente')
tipo_gest	= idw_minutas.GetItemString(1,'tipo_gestion')

if not isnull(n_aviso) then sql_aux += " and (fases_minutas.n_aviso like '"+n_aviso+"%')" 
if not isnull(imported) then sql_aux += " and (fases_minutas.total_aviso >="+f_cambia_comas_decimales(imported)+")"
if not isnull(importeh) then sql_aux += " and (fases_minutas.total_aviso <="+f_cambia_comas_decimales(importeh)+")" 
if not isnull(honorariosd) then sql_aux += " and (fases_minutas.base_honos >="+f_cambia_comas_decimales(honorariosd)+")" 
if not isnull(honorariosh) then sql_aux += " and ( fases_minutas.base_honos <="+f_cambia_comas_decimales(honorariosh)+")" 
if not isnull(fechad) then sql_aux += " and ( fases_minutas.fecha >='"+string(date(fechad),'yyyymmdd')+"')" 
if not isnull(fechah) then sql_aux += " and ( fases_minutas.fecha <='"+string(date(fechah),'yyyymmdd')+"')" 
if not isnull(fecha_pagod) then sql_aux += " and ( fases_minutas.fecha_pago >='"+string(date(fecha_pagod),'yyyymmdd')+"')" 
if not isnull(fecha_pagoh) then sql_aux += " and ( fases_minutas.fecha_pago <='"+string(date(fecha_pagoh),'yyyymmdd')+"')" 
if not isnull(pendiente) and pendiente <> '%' then sql_aux += " and ( fases_minutas.pendiente like '"+pendiente+"%')" 
if not isnull(tipo_gest) and tipo_gest <> '%' then sql_aux += " and ( fases_minutas.tipo_gestion like '"+tipo_gest+"%')" 

////Tipos_gestion
//coma=false
//opcion = idw_minutas.GetItemString(1,'tipo_gestion')
//if opcion<>'%' then
//	for i=1 to idw_gestion_contrato_minutas.RowCount()
//		if idw_gestion_contrato_minutas.GetItemString(i,'activo') = 'S' then
//			if coma then codigos= codigos+','
//			codigos = codigos+"'"+idw_gestion_contrato_minutas.GetItemString(i,'codigo')+"'"
//			coma = true
//		end if
//	next
//end if

///*** Se cambia para aligerar la consulta del listado para certificados. Alexis. 20/07/2010. CRI-244
if sql_aux <> '' or codigos <> '' then
	ls_listado = dw_listados_varios.GetItemString(dw_listados_varios.GetRow(),'dw')
	Choose case ls_listado
		case 'd_fases_listado_por_colegiado_certif_mur'
		isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase *= fases_minutas.id_fase )'})	
	case else	
		isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_minutas.id_fase )'})
	end choose	
	isql_nuevo += sql_aux
		//	if codigos <> '' then isql_nuevo += ' and fases_minutas.tipo_gestion IN ( '+codigos+')'
end if
end event

event csd_consulta_otros_documentos();boolean coma
string codigos,sql_aux,operador,opcion
string registro, pendiente, sql_aux2=''
datetime fechad, fechah, fecha_rd,fecha_rh

int i

idw_otros_docs.AcceptText()

registro		= idw_otros_docs.GetItemString(1,'registro')
fechad 		= idw_otros_docs.GetItemDatetime(1,'fechad')
fechah 		= idw_otros_docs.GetItemDatetime(1,'fechah')
fecha_rd 	= idw_otros_docs.GetItemDatetime(1,'fecha_rd')
fecha_rh 	= idw_otros_docs.GetItemDatetime(1,'fecha_rh')


if not isnull(registro) then sql_aux += " and (fases_documentos.n_reg like '"+registro+"%')"
if not isnull(fechad) then sql_aux += " and (fases_documentos.f_entrada >='"+string(date(fechad),'yyyymmdd')+"')"
if not isnull(fechah) then sql_aux += " and (fases_documentos.f_entrada <='"+string(date(fechah),'yyyymmdd')+"')"
if not isnull(fecha_rd) then sql_aux += " and (fases_documentos.f_retira >='"+string(date(fecha_rd),'yyyymmdd')+"')"
if not isnull(fecha_rh) then sql_aux += " and (fases_documentos.f_retira <='"+string(date(fecha_rh),'yyyymmdd')+"')"

//Otros Documentos
coma=false
opcion = idw_otros_docs.GetItemString(1,'tipo')
if opcion<>'%' then
	for i=1 to idw_otros_doc_contrato.RowCount()
		if idw_otros_doc_contrato.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_otros_doc_contrato.GetItemString(i,'codigo')+"'"
			coma = true
		end if
	next

end if

if sql_aux <> '' or codigos <> '' then
	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_documentos.id_fase )'})
	isql_nuevo += sql_aux
	if codigos <> '' then isql_nuevo += ' and fases_documentos.tipo IN ( '+codigos+')'
end if

end event

event csd_consulta_pem_hono();boolean coma
string codigos,sql_aux,operador,opcion
string n_aviso, pendiente, sql_aux2=''
double pemd, pemh,honorariosd, honorariosh
int i

idw_pem_hono.AcceptText()

f_sql('fases.honorarios','>=','honorariosd',idw_pem_hono,isql_nuevo,g_tipo_base_datos,'')
f_sql('fases.honorarios','<=','honorariosh',idw_pem_hono,isql_nuevo,g_tipo_base_datos,'')

pemd			= idw_pem_hono.GetItemnumber(1,'pemd')
pemh			= idw_pem_hono.GetItemnumber(1,'pemh')

sql_aux = ''
if not isnull(pemd) then sql_aux +=  " and (fases_usos.pem >="+string(pemd)+")"
if not isnull(pemh) then sql_aux +=  " and (fases_usos.pem <="+string(pemh)+")"

if sql_aux <> ''  then
	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_usos.id_fase )'})
	isql_nuevo += sql_aux
end if

if sql_aux <> ''  then isql_nuevo += sql_aux

end event

event csd_consulta_principal();string n_colegiado,n_nif, ls_trabajos_intercolegiales
string sql_cliente, sql_representante, id_colegiado, ls_sql_aux
int li_col, li_i

// Se inicializan los id de Colegiado y cliente para no alterar el sql
idw_principal.setitem(1,'id_colegiado','')
idw_principal.setitem(1,'id_cliente','')
// Se preparan los id de Colegiados y Cliente
n_colegiado = idw_principal.getitemstring(1,'n_colegiado')

id_colegiado	= f_busca_id_colegiado_por_codigo(n_colegiado)

if not f_es_vacio(n_colegiado) then
	//idw_principal.setitem(1,'id_colegiado',f_busca_id_colegiado_por_codigo(n_colegiado))
	idw_principal.setitem(1,'id_colegiado',id_colegiado)
end if	


n_nif = idw_principal.getitemstring(1,'nif_promotor')
//if not f_es_vacio(n_nif) then
//		idw_principal.setitem(1,'id_cliente',f_cliente_nif(n_nif))
//end if

// Cogemos la sql en este punto
sql_cliente = isql_nuevo
f_sql('fases_clientes.id_cliente','LIKE','id_cliente',idw_principal,isql_nuevo,g_tipo_base_datos,'Cliente') 
f_sql('clientes.nif','LIKE','nif_promotor',idw_principal,isql_nuevo,g_tipo_base_datos,'Nif Cliente') 
f_sql('clientes.apellidos','LIKE','nombre_promotor',idw_principal,isql_nuevo,g_tipo_base_datos,'Cliente') 
f_sql('clientes.tipo_persona','LIKE','t_persona',idw_principal,isql_nuevo,g_tipo_base_datos,'Tipo Persona') 

//Buscamos la tabla CLIENTES dentro de las tablas del datawindow
string sql_esta_clientes
boolean esta
sql_esta_clientes = dw_1.describe("datawindow.table.select")
esta = match(sql_esta_clientes,'clientes')

if sql_cliente<>isql_nuevo then
	if (esta = false) then 
		//Si hace falta la tabla clientes para la busqueda y no esta hacemos el sql_join
		isql_nuevo = f_sql_join(isql_nuevo, {'fases_clientes.id_cliente = clientes.id_cliente '})// Modificado por Ricardo 04-04-05
	
	///***Modificado por Alexis para adaptar el listado denominado finales de obra para que introduzca la tabla de clientes y la 
	// enlace correctamente con la tabla fases_finales. CGC-159. 10/02/2010 ***///
	else 
		if dw_listados_varios.GetItemString(dw_listados_varios.GetRow(),'dw') = 'd_fases_listado_finales_obra' then
		isql_nuevo = f_sql_join(isql_nuevo, {'fases_clientes.id_cliente = clientes.id_cliente ', ' fases_clientes.id_fase = fases_finales.id_fase '})	
		end if	
	///*** FIN modificaci$$HEX1$$f300$$ENDHEX$$n CGC-159. ALEXIS***///

	end if
else
	// cogemos la sql en este punto
	sql_representante = isql_nuevo
	f_sql('clientes.nif','LIKE','nif_representante',idw_principal,isql_nuevo,g_tipo_base_datos,'Nif Representante') 
	f_sql('fases_clientes.id_representante','LIKE','id_representante',idw_principal,isql_nuevo,g_tipo_base_datos,'Representante') 
	f_sql('clientes.apellidos','LIKE','nombre_representante',idw_principal,isql_nuevo,g_tipo_base_datos,'Representante') 
	if sql_representante<>isql_nuevo then
		if (esta = false) then
			//Si hace falta la tabla clientes para la busqueda y no esta hacemos el sql_join
			isql_nuevo = f_sql_join(isql_nuevo, {'fases_clientes.id_representante = clientes.id_cliente '})// Modificado por Ricardo 04-04-05
		end if
	end if
end if

// Se prepara el formato del N$$HEX2$$ba002000$$ENDHEX$$Expediente
if not f_es_vacio(idw_principal.getitemstring(1,'n_expediente')) then
	isql_nuevo=isql_nuevo + "and expedientes.n_expedi LIKE '" + i_exp + "%'"
end if

// FASES
f_sql('fases.n_registro','LIKE','n_registro',idw_principal,isql_nuevo,g_tipo_base_datos,'N$$HEX2$$ba002000$$ENDHEX$$Registro')
f_sql('fases.archivo','LIKE','archivo_fases',idw_principal,isql_nuevo,g_tipo_base_datos,'N$$HEX2$$ba002000$$ENDHEX$$Sal./Archi. Contrato')// Modificado por Ricardo 04-04-02
f_sql('fases.tipo_registro','LIKE','tipo_Registro',idw_principal,isql_nuevo,g_tipo_base_datos,'Tipo Registro')
f_sql('fases.fase','LIKE','fase',idw_principal,isql_nuevo,g_tipo_base_datos,'Tipo Actuaci$$HEX1$$f300$$ENDHEX$$n')
f_sql('fases.tipo_trabajo','=','tipo_trabajo',idw_principal,isql_nuevo,g_tipo_base_datos,'Tipo Obra')
f_sql('fases.id_tramite','LIKE','tipo_tramite',idw_principal,isql_nuevo,g_tipo_base_datos,'Tipo Tr$$HEX1$$e100$$ENDHEX$$mite')
f_sql('fases.trabajo','=','trabajo',idw_principal,isql_nuevo,g_tipo_base_datos,'Destino')
f_sql('fases.descripcion','LIKE','descripcion',idw_principal,isql_nuevo,g_tipo_base_datos,'')//Modificado por Yexaira 28-08-07
f_sql('fases.emplazamiento','LIKE INSIDE','emplazamiento',idw_principal,isql_nuevo,g_tipo_base_datos,'Emplazamiento')
f_sql('fases.n_calle','LIKE','n_calle',idw_principal,isql_nuevo,g_tipo_base_datos,'N$$HEX2$$ba002000$$ENDHEX$$Calle')
f_sql('fases.poblacion','=','poblacion',idw_principal,isql_nuevo,g_tipo_base_datos,'C.P. Poblaci$$HEX1$$f300$$ENDHEX$$n')
f_sql('fases.f_entrada','>=','f_entrada_desde',idw_principal,isql_nuevo,g_tipo_base_datos,'F.Entrada')
f_sql('fases.f_entrada','<','f_entrada_hasta',idw_principal,isql_nuevo,g_tipo_base_datos,'F.Entrada')
f_sql('fases.f_visado','>=','f_visado_desde',idw_principal,isql_nuevo,g_tipo_base_datos,'F.Visado')
f_sql('fases.f_visado','<','f_visado_hasta',idw_principal,isql_nuevo,g_tipo_base_datos,'F.Visado')
f_sql('fases.f_abono','>=','f_abono_desde',idw_principal,isql_nuevo,g_tipo_base_datos,'F.Abono')
f_sql('fases.f_abono','<','f_abono_hasta',idw_principal,isql_nuevo,g_tipo_base_datos,'F.Abono')
f_sql('fases.e_mail','LIKE','visared',idw_principal,isql_nuevo,g_tipo_base_datos,'Visared')
f_sql('fases.num_coac','LIKE','coac',idw_principal,isql_nuevo,g_tipo_base_datos,'N$$HEX2$$ba002000$$ENDHEX$$COAC')// Modificado por Ricardo 04-04-05

// EXPEDIENTES
isql_nuevo = f_sql_join(isql_nuevo, {' fases.id_expedi = expedientes.id_expedi '})
f_sql('expedientes.administracion','=','obra_oficial',idw_principal,isql_nuevo,g_tipo_base_datos,'Obra Admon.')	
f_sql('expedientes.archivo','LIKE','archivo',idw_principal,isql_nuevo,g_tipo_base_datos,'N$$HEX2$$ba002000$$ENDHEX$$Sal./Archi. Exp.')
f_sql('expedientes.f_cierre','>=','f_cfo_desde',idw_principal,isql_nuevo,g_tipo_base_datos,'')
f_sql('expedientes.f_cierre','<','f_cfo_hasta',idw_principal,isql_nuevo,g_tipo_base_datos,'') 
f_sql('expedientes.cerrado','LIKE','cerrado',idw_principal,isql_nuevo,g_tipo_base_datos,'')

// POBLACIONES
string poblacion, mopu

poblacion	= idw_principal.GetItemstring(1,'des_poblacion')
mopu	= idw_principal.GetItemstring(1,'cod_mopu')

if (not isnull(poblacion)) or (not isnull(mopu)) then
	isql_nuevo = f_sql_join(isql_nuevo, {' fases.poblacion = poblaciones.cod_pob '})

	f_sql('poblaciones.descripcion','=','des_poblacion',idw_principal,isql_nuevo,g_tipo_base_datos,'Poblaci$$HEX1$$f300$$ENDHEX$$n')
	f_sql('poblaciones.pob_mopu','LIKE','cod_mopu',idw_principal,isql_nuevo,g_tipo_base_datos,'')
end if

// COLEGIADOS
string nombre_colegiado


//n_colegiado	= idw_principal.GetItemstring(1,'n_colegiado')
nombre_colegiado	= idw_principal.GetItemstring(1,'nombre_colegiado')

li_col = UpperBound(ist_fases_col_soc.id_colegiados)
if (not f_es_vacio(ist_fases_col_soc.id_sociedad) and li_col > 0) then

isql_nuevo = f_sql_join(isql_nuevo, {' fases.id_fase = fases_colegiados.id_fase '})
isql_nuevo = f_sql_join(isql_nuevo, {' fases_colegiados.id_col = colegiados.id_colegiado '})
f_sql('colegiados.apellidos','LIKE','nombre_colegiado',idw_principal,isql_nuevo,g_tipo_base_datos,'Colegiado')

ls_sql_aux = ''
	
	For li_i = 1 To li_col
		if not f_es_vacio(ist_fases_col_soc.id_colegiados[li_i]) then
			if f_es_vacio(ls_sql_aux) then
				ls_sql_aux = " (fases_colegiados.id_col = '"+ ist_fases_col_soc.id_colegiados[li_i] + "' "	
			else
				ls_sql_aux += " or fases_colegiados.id_col = '"+ ist_fases_col_soc.id_colegiados[li_i] + "' "	
			end if	
		end if	
	next
	if not f_es_vacio(ls_sql_aux) then 
		ls_sql_aux += ") "
		if PosA(upper(isql_nuevo), "WHERE") > 0 then
			isql_nuevo += ' and '+ ls_sql_aux
		else
			isql_nuevo += ' WHERE '+ ls_sql_aux
		end if	
	end if

else 
	if (not f_es_vacio(id_colegiado)) or (not f_es_vacio(n_colegiado) ) or (not f_es_vacio(nombre_colegiado) ) then
		isql_nuevo = f_sql_join(isql_nuevo, {' fases.id_fase = fases_colegiados.id_fase '})
		isql_nuevo = f_sql_join(isql_nuevo, {' fases_colegiados.id_col = colegiados.id_colegiado '})

		f_sql('fases_colegiados.id_col','=','id_colegiado',idw_principal,isql_nuevo,g_tipo_base_datos,'')  // El LIKE no funciona bien en COAATLR
		f_sql('colegiados.n_colegiado','=','n_colegiado',idw_principal,isql_nuevo,g_tipo_base_datos,'N$$HEX2$$ba002000$$ENDHEX$$Colegiado')  // El LIKE no funciona bien en COAATLR
		f_sql('colegiados.apellidos','LIKE','nombre_colegiado',idw_principal,isql_nuevo,g_tipo_base_datos,'Colegiado')
	end if
end if

//SCP-1702
ls_sql_aux = ''
ls_trabajos_intercolegiales = idw_principal.GetItemString(1,'trabajos_intercolegiales')
choose case ls_trabajos_intercolegiales
	case 'I'
		ls_sql_aux = " (fases.cod_colegio_dest <> '" + g_cod_colegio + "' "	
	case 'P'
		ls_sql_aux = " (fases.cod_colegio_dest = '" + g_cod_colegio + "' "			
		// No se tiene en cuenta en caso de que el valor sea 'T'	
end choose
if not f_es_vacio(ls_sql_aux) then 
	ls_sql_aux += ") "
	if PosA(upper(isql_nuevo), "WHERE") > 0 then
		isql_nuevo += ' and '+ ls_sql_aux
	else
		isql_nuevo += ' WHERE '+ ls_sql_aux
	end if	
end if

// f_sql('expedientes.n_expedi','LIKE','n_expediente',idw_principal,sql_nuevo,g_tipo_base_datos,'')
// f_sql('fases.titulo','LIKE','descripcion_trabajo',idw_principal,isql_nuevo,g_tipo_base_datos,'')
// f_sql('fases.tipo_gestion','LIKE','tipo_gestion',idw_principal,isql_nuevo,g_tipo_base_datos,'')
// f_sql('fases.modalidad','LIKE','codigo_especial',idw_principal,isql_nuevo,g_tipo_base_datos,'')
//	f_sql('fases.aplicado_10','=','aplicado_10',idw_principal,sql_nuevo,g_tipo_base_datos,'')

//A$$HEX1$$f100$$ENDHEX$$adido por Eloy 9/7/09
integer b,pos
string fases_a_incluir,fase,sql_aux2
fases_a_incluir = idw_principal.GetItemString(1,'fases')

b=1
pos=1
if not(f_es_vacio(fases_a_incluir)) then
	pos=PosA(fases_a_incluir,',',b)
	sql_aux2 = " and ( 1 = 2 " 
	do while b<LenA(fases_a_incluir)
		if pos=0 then pos=LenA(fases_a_incluir)+1
		fase = MidA(fases_a_incluir,b,pos - b)
		if not isnull(fase) then 
			fase = fase + '%'
			sql_aux2 = sql_aux2 + " or (fases.fase like '" + fase + "')" 
		end if
		b=pos+1
		pos=PosA(fases_a_incluir,',',b)
	loop
	sql_aux2 = sql_aux2 + ")"
end if

isql_nuevo = isql_nuevo + sql_aux2

// <-- Hasta aqui



end event

event csd_consulta_reclamaciones();string sql_aux,sql_aux2='', n_aviso
datetime fechad, fechah
int i

idw_reclamaciones.AcceptText()

fechad 		= idw_reclamaciones.GetItemDatetime(1,'fechad')
fechah 		= idw_reclamaciones.GetItemDatetime(1,'fechah')
n_aviso		= idw_reclamaciones.GetItemstring(1,'n_aviso')

if not isnull(fechad) then sql_aux= sql_aux + " and (fases_reclamaciones.f_reclamacion >='"+string(date(fechad),'yyyymmdd')+"')"
if not isnull(fechah) then sql_aux= sql_aux + " and (fases_reclamaciones.f_reclamacion <='"+string(date(fechah),'yyyymmdd')+"')"
if not isnull(n_aviso) then sql_aux= sql_aux + " and (fases_minutas.n_aviso like '"+n_aviso+"%')"

if sql_aux <> ''  then
	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_minutas.id_fase )', '( fases_minutas.id_minuta = fases_reclamaciones.id_minuta )'})
	isql_nuevo += sql_aux
end if
end event

event csd_consulta_registros();string sql_aux,sql_aux2='', tipo
datetime fechad, fechah
double presupuestod,presupuestoh
int i

idw_registro_es.AcceptText()

fechad 		= idw_registro_es.GetItemDatetime(1,'fechad')
fechah 		= idw_registro_es.GetItemDatetime(1,'fechah')

if not isnull(fechad) then sql_aux += " and (registro.fecha >='"+string(date(fechad),'yyyymmdd')+"')"
if not isnull(fechah) then sql_aux += " and (registro.fecha <='"+string(date(fechah),'yyyymmdd')+"')"

if sql_aux <> ''  then
	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.n_registro = registro.n_expediente)'})
	isql_nuevo += sql_aux
end if
end event

event csd_consulta_reparos();string sql_aux,sql_aux2='', tipo
datetime fechad, fechah, fechafd, fechafh
double presupuestod,presupuestoh
int i

idw_reparos.AcceptText()

fechad 		= idw_reparos.GetItemDatetime(1,'fechad')
fechah 		= idw_reparos.GetItemDatetime(1,'fechah')
fechafd 		= idw_reparos.GetItemDatetime(1,'fechafd')
fechafh 		= idw_reparos.GetItemDatetime(1,'fechafh')

if not isnull(fechad) then sql_aux += " and ( fases_reparos.f_emision >='"+string(date(fechad),'yyyymmdd')+"')"
if not isnull(fechah) then sql_aux += " and ( fases_reparos.f_emision <='"+string(date(fechah),'yyyymmdd')+"')"
if not isnull(fechafd) then sql_aux +=" and ( fases_reparos.f_subsanacion >='"+string(date(fechafd),'yyyymmdd')+"')"
if not isnull(fechafh) then sql_aux +=" and ( fases_reparos.f_subsanacion <='"+string(date(fechafh),'yyyymmdd')+"')"

if sql_aux <> ''  then
	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_reparos.id_fase )'})
	isql_nuevo += sql_aux
end if


end event

event csd_consulta_residente();boolean coma
string codigos,sql_aux,operador,opcion
string alta,sql_aux2=''
int i

//Todos los colegiados que Tengan el residente elegido, ya q se pueden elegir varias de una lista
opcion = idw_opcion_residente.GetItemString(1,'opcion')
if opcion<>'%' then
	if not f_es_vacio(sql_aux2) then sql_aux2 = 'and '+sql_aux2
	coma=false
	for i=1 to idw_residente.RowCount()
		if idw_residente.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_residente.GetItemString(i,'c_geografico')+"'"
			coma = true
		end if
	next
	if opcion='S' then operador=''
	if opcion='N' then operador='NOT'
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and colegiados.c_geografico "+operador+" IN  ("+codigos+")"
		else
			sql_aux = "WHERE colegiados.c_geografico "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
else
	if not(f_es_vacio(sql_aux2)) then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = 'and ' + sql_aux2
		else
			sql_aux = "WHERE " + sql_aux2
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
end if

end event

event csd_oculta();boolean gest_min, estado_cont, gest_cont, modal_cont, tipo_docs, agr, sitprof, incomp, sitresi, alta, baja, situ
boolean tipoact, tipoobra, destino

//gest_min = (idw_minutas.getitemstring(1, 'tipo_gestion') = 'S')
//idw_gestion_contrato_minutas.visible = gest_min

estado_cont = (idw_seleccion_estados.getitemstring(1, 'opcion') = 'S')
idw_estados_contrato.visible = estado_cont
tab_1.tabpage_2.cb_todos1.visible = estado_cont
tab_1.tabpage_2.cb_borrar1.visible = estado_cont

gest_cont = (idw_seleccion_gestion.getitemstring(1, 'opcion') = 'S')
idw_gestion_contrato.visible = gest_cont
tab_1.tabpage_2.cb_todos2.visible = gest_cont
tab_1.tabpage_2.cb_borrar2.visible = gest_cont

modal_cont = (idw_seleccion_modalidad.getitemstring(1, 'opcion') = 'S')
idw_modalidad_contrato.visible = modal_cont
tab_1.tabpage_2.cb_todos3.visible = modal_cont
tab_1.tabpage_2.cb_borrar3.visible = modal_cont

tipo_docs = (idw_otros_docs.getitemstring(1, 'tipo') = 'S')
idw_otros_doc_contrato.visible = tipo_docs

agr = (idw_opcion_agr.GetItemString(1,'opcion')='S')
idw_agrupaciones.visible = agr
tab_1.tabpage_3.cb_incluir4.visible = agr
tab_1.tabpage_3.cb_borrar4.visible = agr

sitprof = (idw_opcion_sit.GetItemString(1,'opcion')='S')  
idw_sit_profesionales.visible = sitprof
tab_1.tabpage_3.cb_3.visible = sitprof
tab_1.tabpage_3.cb_4.visible = sitprof

incomp = (idw_opcion_incomp.GetItemString(1,'opcion')='S')
idw_incompatibilidades.visible = incomp
tab_1.tabpage_3.cb_5.visible = incomp
tab_1.tabpage_3.cb_6.visible = incomp

sitresi = ( idw_opcion_residente.GetItemString(1,'opcion')='S')  
idw_residente.visible = sitresi
tab_1.tabpage_10.cb_todos5.visible = sitresi
tab_1.tabpage_10.cb_borrar5.visible = sitresi


situ = ( idw_opcion_situaciones.GetItemString(1,'opcion')='S')  
idw_situaciones.visible = situ
tab_1.tabpage_4.cb_todos10.visible = situ
tab_1.tabpage_4.cb_borrar10.visible = situ

tipoact =  ( idw_tipo_actuacion_seleccion.GetItemString(1,'opcion')='S')  
idw_tipoact.visible = tipoact
tab_1.tabpage_9.cb_todos1_est.visible = tipoact
tab_1.tabpage_9.cb_borrar1_est.visible = tipoact

tipoobra =  ( idw_tipo_obra_seleccion.GetItemString(1,'opcion')='S')  
idw_tipoobra.visible = tipoobra
tab_1.tabpage_9.cb_todos2_est.visible = tipoobra
tab_1.tabpage_9.cb_borrar2_est.visible = tipoobra

destino =  ( idw_destino_seleccion.GetItemString(1,'opcion')='S')  
idw_destino.visible = destino
tab_1.tabpage_9.cb_todos3_est.visible = destino
tab_1.tabpage_9.cb_borrar3_est.visible = destino

string data
data = idw_alta_si_no.GetItemString(1,'alta')
choose case data 
 case 'S' 
  alta = true
  baja = false
  //tab_1.tabpage_4.cb_todos2.TriggerEvent(Clicked!)
 case 'N'
  alta = false
  baja = true
//  tab_1.tabpage_4.cb_todos30.TriggerEvent(Clicked!)
 case else
  alta = false
  baja = false
end choose
 
tab_1.tabpage_4.gb_3.visible= baja
tab_1.tabpage_4.cb_todos30.visible= baja
tab_1.tabpage_4.cb_borrar30.visible = baja
idw_t_baja.visible = baja
tab_1.tabpage_4.gb_2.visible=alta
tab_1.tabpage_4.cb_todos20.visible=alta
tab_1.tabpage_4.cb_borrar20.visible = alta
idw_t_alta.visible = alta



end event

event csd_consulta_estadistica();string codigos,sql_aux,opcion,operador
boolean coma
int i


// Tipo de actuaci$$HEX1$$f300$$ENDHEX$$n
opcion = idw_tipo_actuacion_seleccion.GetItemString(1,'opcion')
if opcion<>'%' then 
	coma=false
	for i=1 to idw_tipoact.RowCount()
		if idw_tipoact.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_tipoact.GetItemString(i,'c_t_fase')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and fases.fase "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE fases.fase "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
end if

//Tipo de obra
coma=false
codigos=''
opcion = idw_tipo_obra_seleccion.GetItemString(1,'opcion')
if opcion<>'%' then 
	for i=1 to idw_tipoobra.RowCount()
		if idw_tipoobra.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_tipoobra.GetItemString(i,'c_t_trabajo')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and fases.tipo_trabajo "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE fases.tipo_trabajo "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if
end if
	
// Destino
coma=false
codigos=''
opcion = idw_destino_seleccion.GetItemString(1,'opcion')
if opcion<>'%' then 
	for i=1 to idw_destino.RowCount()
		if idw_destino.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_destino.GetItemString(i,'c_trabajo')+"'"
			coma = true
		end if
	next
	if opcion = 'S' then operador=''
	if opcion = 'N' then operador = 'NOT'
	if codigos<>'' then
		if PosA(upper(isql_nuevo), "WHERE") > 0  then
			sql_aux = "and fases.trabajo "+operador+" IN ("+codigos+")"
		else
			sql_aux = "WHERE fases.trabajo "+operador+" IN ("+codigos+")"
		end if	
		if not isnull(sql_aux) then isql_nuevo += sql_aux
	end if	
end if
end event

event csd_consulta_tarifas();// COAATZ
boolean coma
string codigos, sql_aux, opcion
long i

coma=false
opcion = idw_opcion_tarifas.GetItemString(1,'opcion')
if opcion<>'%' then
	for i=1 to idw_tarifas.RowCount()
		if idw_tarifas.GetItemString(i,'activo') = 'S' then
			if coma then codigos= codigos+','
			codigos = codigos+"'"+idw_tarifas.GetItemString(i,'cod_tarifa')+"'"
			coma = true
		end if
	next

end if

if codigos <> '' then
	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_cip_tfe.id_fase )'})
	isql_nuevo += sql_aux
	if codigos <> '' then isql_nuevo += ' and fases_cip_tfe.tarifa IN ( '+codigos+')'
end if

end event

event csd_consulta_renuncia();// Juli$$HEX1$$e100$$ENDHEX$$n Melero

string sql_aux,sql_aux2='', tipo,renuncia, web
datetime fechad, fechah
double presupuestod,presupuestoh
int i

idw_renuncias.AcceptText()

fechad 	= idw_renuncias.GetItemDatetime(1,'fechad')
fechah 	= idw_renuncias.GetItemDatetime(1,'fechah')
renuncia =  idw_renuncias.GetItemstring(1,'renuncia')
web       =  idw_renuncias.GetItemstring(1,'web')

if not isnull(fechad) then sql_aux += " and (fases_renuncias.fecha >='"+string(date(fechad),'yyyymmdd 00:00:00')+"')"
if not isnull(fechah) then sql_aux += " and (fases_renuncias.fecha <='"+string(date(fechah),'yyyymmdd 23:59:59')+"')"
//if not isnull(renuncia) then sql_aux += " and (fases_renuncias.id_renuncia like '"+right('0000000000' + renuncia,10)+"')"
if not isnull(renuncia) then sql_aux += " and (fases_renuncias.n_renuncia like  '"+renuncia+"%')" 
if not isnull(web) and web <> '%' then sql_aux += " and ( fases_renuncias.web like '"+web+"%')"

if sql_aux <> ''  then
	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_renuncias.id_fase)'})
	isql_nuevo += sql_aux
end if
end event

event consulta_pagos_plataforma();string sql_aux,sql_aux2='', tipo
datetime fecha_pago_desde, fecha_pago_hasta, fecha_orden_pago_desde, fecha_orden_pago_hasta, fecha_importacion_desde, fecha_importacion_hasta
double presupuestod,presupuestoh
int i
long pos_union//, pos_where1, pos_where2, 
string ls_sql_from1, ls_sql_where1, ls_sql_from2, ls_sql_where2

idw_pagos_plataforma.accepttext()

fecha_pago_desde = idw_pagos_plataforma.GetItemDatetime(1,'f_pago_desde')
fecha_pago_hasta = idw_pagos_plataforma.GetItemDatetime(1,'f_pago_hasta')

fecha_orden_pago_desde = idw_pagos_plataforma.GetItemDatetime(1,'f_orden_pago_desde')
fecha_orden_pago_hasta = idw_pagos_plataforma.GetItemDatetime(1,'f_orden_pago_hasta')

fecha_importacion_desde = idw_pagos_plataforma.GetItemDatetime(1,'f_importacion_desde')
fecha_importacion_hasta = idw_pagos_plataforma.GetItemDatetime(1,'f_importacion_hasta')

//pos_union = PosA(upper(isql_nuevo), "UNION")
//ls_sql_from1 = LeftA( isql_nuevo, pos_union -1 )
ls_sql_from2 =  " 	SELECT colegiados.n_colegiado, 		colegiados.apellidos, 		colegiados.nombre, 		fases.n_registro, 		'' as 'csi_facturas_emitidas.n_fact',  		'N' as 'csi_cobros.pagado', 		null as 'csi_cobros.f_pago', 		null as 'csi_facturas_emitidas.fecha', 		fases_pagos_plataforma.importe_pago, 		fases_pagos_plataforma.forma_pago_plataforma, 		fases_pagos_plataforma.importe_pago as 'csi_cobros.importe', fases_pagos_plataforma.codigo_autorizacion, fases_pagos_plataforma.fecha  FROM fases, colegiados, fases_pagos_plataforma   WHERE ( colegiados.n_colegiado = fases_pagos_plataforma.n_colegiado ) and not exists (select * from fases_pagos_facturas where fases_pagos_plataforma.id_fases_pagos_plataforma = fases_pagos_facturas.id_fases_pagos_plataforma)		and ( fases.id_fase = fases_pagos_plataforma.id_fase )  "   

//pos_where1 = PosA(upper(ls_sql_from1), "WHERE")

ls_sql_where1 = trim(rightA( isql_nuevo, len(isql_nuevo) - (PosA(upper(isql_nuevo), "WHERE") + 4)))
ls_sql_from1 = LeftA( isql_nuevo, (PosA(upper(isql_nuevo), "WHERE") -1 ))

ls_sql_where2 = trim(rightA( ls_sql_from2, len(ls_sql_from2) - (PosA(upper(ls_sql_from2), "WHERE") + 4)))
ls_sql_from2 = LeftA( ls_sql_from2, (PosA(upper(ls_sql_from2), "WHERE") -1 ))


if not isnull(fecha_pago_desde) then ls_sql_where1 += " and (csi_cobros.f_pago >='"+string(date(fecha_pago_desde),'yyyymmdd')+"')"
if not isnull(fecha_pago_hasta) then ls_sql_where1 += " and (csi_cobros.f_pago <='"+string(date(fecha_pago_hasta),'yyyymmdd')+"')"

if not isnull(fecha_orden_pago_desde) then 
	ls_sql_where1 += " and (fases_pagos_plataforma.fecha_orden >='"+string(date(fecha_orden_pago_desde),'yyyymmdd')+"')"
	ls_sql_where2 += " and (fases_pagos_plataforma.fecha_orden >='"+string(date(fecha_orden_pago_desde),'yyyymmdd')+"')"
end if	
if not isnull(fecha_orden_pago_hasta) then 
	ls_sql_where1 += " and (fases_pagos_plataforma.fecha_orden <='"+string(date(fecha_orden_pago_hasta),'yyyymmdd')+"')"
	ls_sql_where2 += " and (fases_pagos_plataforma.fecha_orden <='"+string(date(fecha_orden_pago_hasta),'yyyymmdd')+"')"
end if 	

if not isnull(fecha_importacion_desde) then 
	ls_sql_where1 += " and (fases_pagos_plataforma.fecha_importacion >='"+string(date(fecha_importacion_desde),'yyyymmdd')+"')"
	ls_sql_where2 += " and (fases_pagos_plataforma.fecha_importacion >='"+string(date(fecha_importacion_desde),'yyyymmdd')+"')"
end if 

if not isnull(fecha_importacion_hasta) then 
	ls_sql_where1 += " and (fases_pagos_plataforma.fecha_importacion <='"+string(date(fecha_importacion_hasta),'yyyymmdd')+"')"
	ls_sql_where2 += " and (fases_pagos_plataforma.fecha_importacion <='"+string(date(fecha_importacion_hasta),'yyyymmdd')+"')"
end if	



//if sql_aux <> ''  then
//	isql_nuevo = f_sql_join(isql_nuevo, {'( fases.id_fase = fases_pagos_plataforma.id_fase )', '( fases_pagos_plataforma.id_fases_pagos_plataforma= fases_pagos_facturas.id_fases_pagos_plataforma )', '( fases_pagos_facturas.id_factura = csi_facturas_emitidas.id_factura )', '( fases.id_fase = csi_facturas_emitidas.id_minuta )', '( csi_facturas_emitidas.id_factura = csi_cobros.id_factura )'})
//	isql_nuevo += sql_aux
//end 

isql_nuevo = ls_sql_from1 + ' WHERE '+ ls_sql_where1 + ' UNION ' + ls_sql_from2 + ' WHERE '+ ls_sql_where2
end event

public subroutine wf_rellenar_listado (datawindow dw);long i, fila, j
double sup_total, sup_viv, sup_gar, sup_otros, num_edif, num_viv, pem, altura, honos
string zona='', pobla=''
datastore ds_datos_obras, ds_col, ds_cli

setpointer(hourglass!)

// Datastore general
ds_datos_obras = create datastore
ds_datos_obras.dataobject = 'd_fases_listado_completo_exportable'
ds_datos_obras.settransobject(SQLCA)

// Colegiados
ds_col = create datastore
ds_col.dataobject = 'd_fases_colegiados'
ds_col.settransobject(sqlca)

// Clientes
ds_cli = create datastore
ds_cli.dataobject = 'd_fases_promotores'
ds_cli.settransobject(sqlca)


for i = 1 to dw.RowCount()
	fila = ds_datos_obras.insertrow(0)

	// N$$HEX2$$ba002000$$ENDHEX$$Expediente
	ds_datos_obras.setitem(fila, 'num_exp', dw.getitemstring(i, 'fases_n_expedi'))
	// Fecha Cierre
	ds_datos_obras.setitem(fila, 'f_cierre', string(dw.getitemdatetime(i, 'expedientes_f_cierre'), "dd/mm/yyyy"))
	// Obra Oficial
	if dw.getitemstring(i, 'expedientes_administracion') = 'S' then
		ds_datos_obras.setitem(fila, 'obra_admon', 'Obra oficial')
	else
		ds_datos_obras.setitem(fila, 'obra_admon', 'Obra NO oficial')
	end if
	// N$$HEX2$$ba002000$$ENDHEX$$Registro
	ds_datos_obras.setitem(fila, 'num_reg', dw.getitemstring(i, 'fases_n_registro'))
	// Tipo Gesti$$HEX1$$f300$$ENDHEX$$n
	if dw.getitemstring(i, 'fases_tipo_gestion') = 'C' then
		ds_datos_obras.setitem(fila, 'cobro_col', 'Con Gesti$$HEX1$$f300$$ENDHEX$$n Cobro')
	else
		ds_datos_obras.setitem(fila, 'cobro_col', 'Sin Gesti$$HEX1$$f300$$ENDHEX$$n Cobro')
	end if
	// Tipo Actuaci$$HEX1$$f300$$ENDHEX$$n
	ds_datos_obras.setitem(fila, 'tipo_act', dw.GetItemString(i,'fases_fase'))
	// TIpo Obra
	ds_datos_obras.setitem(fila, 'tipo_obra', dw.GetItemString(i,'fases_tipo_trabajo'))	
	// Destino
	ds_datos_obras.setitem(fila, 'destino', dw.GetItemString(i,'fases_trabajo'))
	// Tipo Registro
	ds_datos_obras.setitem(fila, 'tipo_registro', dw.getitemstring(i, 'fases_tipo_registro'))
	// Fecha Abono
	ds_datos_obras.setitem(fila, 'f_abono', string(dw.getitemdatetime(i, 'fases_f_abono'), "dd/mm/yyyy"))
	// Fecha Entrada
	ds_datos_obras.setitem(fila, 'f_entrada', string(dw.getitemdatetime(i, 'fases_f_entrada'), "dd/mm/yyyy"))	
	// Descripci$$HEX1$$f300$$ENDHEX$$n
	ds_datos_obras.setitem(fila, 'descripcion', dw.GetItemString(i,'fases_descripcion'))
	// Clase V$$HEX1$$ed00$$ENDHEX$$a Obra
	// ds_datos_obras.setitem(fila, 'via_obra', dw.GetItemString(i,'fases_tipo_via_emplazamiento'))
	// Direcci$$HEX1$$f300$$ENDHEX$$n Obra
	ds_datos_obras.setitem(fila, 'dir_obra', dw.GetItemString(i,'fases_emplazamiento'))
	// N$$HEX1$$fa00$$ENDHEX$$mero Direcci$$HEX1$$f300$$ENDHEX$$n Obra
	// ds_datos_obras.setitem(fila, 'num_obra', dw.GetItemString(i,'fases_n_calle'))
	// CP Obra
	ds_datos_obras.setitem(fila, 'cp_obra', LeftA(dw.GetItemString(i,'fases_poblacion'), 5))
	// Municipio Obra
	ds_datos_obras.setitem(fila, 'pob_obra', dw.GetItemString(i,'poblaciones_descripcion'))
	// Zona Obra
	zona = ''
	pobla = dw.GetItemString(i,'fases_poblacion')
	select poblaciones_zonas.descripcion into :zona from poblaciones_zonas, poblaciones
	where poblaciones_zonas.codigo = poblaciones.zona and poblaciones.cod_pob = :pobla ;
	ds_datos_obras.setitem(fila, 'zona_obra', zona)
	// Honorarios
	honos = dw.GetItemnumber(i,'fases_honorarios')
	if isnull(honos) then honos = 0
	ds_datos_obras.setitem(fila, 'honorarios', string(honos))
	// Visared
	if dw.GetItemString(i,'fases_e_mail') = 'V' then
		ds_datos_obras.setitem(fila, 'visared', 'S')
	else
		ds_datos_obras.setitem(fila, 'visared', 'N')
	end if
	
	// CLIENTES
	ds_cli.retrieve(dw.getitemstring(i, 'fases_id_fase'))
	for j = 1 to ds_cli.rowcount()
		if j>5 then exit
		ds_datos_obras.setitem(fila, 'nif_cli_'+ string(j), f_dame_nif(ds_cli.GetItemString(j,'id_cliente')))
		ds_datos_obras.setitem(fila, 'nom_cli_'+ string(j), ds_cli.GetItemString(j,'cliente'))
	next 
	
	// COLEGIADOS
	ds_col.retrieve(dw.getitemstring(i, 'fases_id_fase'))
	for j = 1 to ds_col.rowcount()
		if j>5 then exit
		ds_datos_obras.setitem(fila, 'n_col_'+ string(j), f_colegiado_n_col(ds_col.GetItemString(j,'id_col')))
		ds_datos_obras.setitem(fila, 'nom_col_'+ string(j), ds_col.GetItemString(j,'compute_1'))
	next 

	// ESTADISTICAS
	// N$$HEX2$$ba002000$$ENDHEX$$Edificios
	num_edif = dw.GetItemNumber(i,'fases_usos_num_edif')
	if isnull(num_edif) then num_edif = 0
	ds_datos_obras.setitem(fila, 'num_edif', string(num_edif))
	// N$$HEX2$$ba002000$$ENDHEX$$Viviendas
	num_viv = dw.GetItemNumber(i,'fases_usos_num_viv')
	if isnull(num_viv) then num_viv = 0
	ds_datos_obras.setitem(fila, 'num_viv', string(num_viv))
	// Superficie Total
	sup_viv = dw.GetItemNumber(i,'fases_usos_sup_viv')
	sup_gar = dw.GetItemNumber(i,'fases_usos_sup_garage')
	sup_otros = dw.GetItemNumber(i,'fases_usos_sup_otros')	
	if isnull(sup_viv) then sup_viv = 0
	if isnull(sup_gar) then sup_gar = 0
	if isnull(sup_otros) then sup_otros = 0
	sup_total = sup_viv + sup_gar + sup_otros
	ds_datos_obras.setitem(fila, 'sup_total', string(sup_total))
	// Superficie Viviendas
	ds_datos_obras.setitem(fila, 'sup_viv', string(sup_viv))
	// Superficie Garaje
	ds_datos_obras.setitem(fila, 'sup_gar', string(sup_gar))
	// Superficie Otros
	ds_datos_obras.setitem(fila, 'sup_otros', string(sup_otros))	
	// Presupuesto Ejecuci$$HEX1$$f300$$ENDHEX$$n Material
	ds_datos_obras.setitem(fila, 'pem', string(dw.GetItemnumber(i,'fases_usos_pem')))
	// Altura
	altura = dw.GetItemNumber(i,'fases_usos_altura')
	if isnull(altura) then altura = 0	
	ds_datos_obras.setitem(fila, 'altura', string(altura))
Next

setpointer(arrow!)

dw_1.dataobject = 'd_fases_listado_completo_exportable'
dw_1.of_SetTransObject(SQLCA)

// Copiamos los datos al listado que se va a mostrar
ds_datos_obras.rowscopy(1, ds_datos_obras.rowcount(), Primary!, dw_1, 1, Primary!)

destroy ds_datos_obras
destroy ds_cli
destroy ds_col

end subroutine

on w_fases_listados.create
int iCurrent
call super::create
this.tab_1=create tab_1
this.cb_1=create cb_1
iCurrent=UpperBound(this.Control)
this.Control[iCurrent+1]=this.tab_1
this.Control[iCurrent+2]=this.cb_1
end on

on w_fases_listados.destroy
call super::destroy
destroy(this.tab_1)
destroy(this.cb_1)
end on

event open;call super::open;f_centrar_ventana(this) 

dw_listados_varios.SetTrans(sqlca)
dw_listados_varios.retrieve(this.classname())
dw_listados_varios.SetRow(1)

// Se desplaza el apuntador al primer registro
dw_listados_varios.scrolltorow(1)
dw_listados_varios.setfocus()


idw_principal = tab_1.tabpage_1.dw_principal
idw_pem_hono = tab_1.tabpage_1.dw_pem_hono

idw_estados_contrato = tab_1.tabpage_2.dw_estados_contrato
idw_gestion_contrato = tab_1.tabpage_2.dw_gestion_contrato
idw_modalidad_contrato = tab_1.tabpage_2.dw_modalidad_contrato
idw_colegio_dest =  tab_1.tabpage_2.dw_consulta_col_destino
idw_seleccion_col_dest =  tab_1.tabpage_2.dw_seleccion_col_destino
idw_seleccion_estados = tab_1.tabpage_2.dw_seleccion_estados
idw_seleccion_gestion = tab_1.tabpage_2.dw_seleccion_gestion
idw_seleccion_modalidad = tab_1.tabpage_2.dw_seleccion_modalidad
idw_datos_agrupacion = tab_1.tabpage_3.dw_datos_agrupacion
idw_datos_sitprof = tab_1.tabpage_3.dw_datos_sitprof
idw_agrupaciones = tab_1.tabpage_3.dw_agrupaciones
idw_sit_profesionales = tab_1.tabpage_3.dw_sit_profesionales
idw_incompatibilidades = tab_1.tabpage_3.dw_incompatibilidades
idw_opcion_agr = tab_1.tabpage_3.dw_opcion_agr
idw_opcion_sit = tab_1.tabpage_3.dw_opcion_sit
idw_opcion_incomp = tab_1.tabpage_3.dw_opcion_incomp
idw_alta_si_no = tab_1.tabpage_4.dw_alta_si_no
idw_opcion_situaciones = tab_1.tabpage_4.dw_opcion_situaciones
idw_opcion_altas = tab_1.tabpage_4.dw_opcion_altas
idw_opcion_bajas = tab_1.tabpage_4.dw_opcion_bajas
idw_situaciones = tab_1.tabpage_4.dw_situaciones
idw_t_alta = tab_1.tabpage_4.dw_t_alta
idw_t_baja = tab_1.tabpage_4.dw_t_baja
idw_minutas = tab_1.tabpage_5.dw_minutas
idw_final_obra = tab_1.tabpage_6.dw_final_obra
idw_garantias = tab_1.tabpage_6.dw_garantias
idw_reclamaciones = tab_1.tabpage_6.dw_reclamaciones
idw_reparos = tab_1.tabpage_6.dw_reparos
idw_registro_es = tab_1.tabpage_6.dw_registro_es
idw_otros_docs = tab_1.tabpage_7.dw_otros_docs
idw_otros_doc_contrato = tab_1.tabpage_7.dw_otros_doc_contrato
idw_arquitectos = tab_1.tabpage_8.dw_arquitectos
idw_residente = tab_1.tabpage_10.dw_residente
idw_opcion_residente = tab_1.tabpage_10.dw_opcion_residente
idw_tipo_actuacion_seleccion = tab_1.tabpage_9.dw_tipo_actuacion_seleccion
idw_tipo_obra_seleccion = tab_1.tabpage_9.dw_tipo_obra_seleccion
idw_destino_seleccion = tab_1.tabpage_9.dw_destino_seleccion
idw_tipoact = tab_1.tabpage_9.dw_tipoact
idw_tipoobra = tab_1.tabpage_9.dw_tipoobra
idw_destino = tab_1.tabpage_9.dw_destino
idw_tarifas = tab_1.tabpage_11.dw_honos_tarifas
idw_opcion_tarifas = tab_1.tabpage_11.dw_opcion_tarifa
idw_renuncias =     tab_1.tabpage_6.dw_renuncias
idw_pagos_plataforma = tab_1.tabpage_6.dw_pagos_plataforma

idw_principal.insertrow(0)
idw_pem_hono.insertrow(0)
idw_seleccion_col_dest.insertrow(0)
idw_seleccion_estados.insertrow(0)
idw_seleccion_gestion.insertrow(0)
idw_seleccion_modalidad.insertrow(0)
idw_datos_agrupacion.insertrow(0)
idw_datos_sitprof.insertrow(0)
idw_opcion_agr.insertrow(0)
idw_opcion_sit.insertrow(0)
idw_opcion_incomp.insertrow(0)
idw_datos_agrupacion.insertrow(0)
idw_alta_si_no.insertrow(0)
idw_opcion_situaciones.insertrow(0)
idw_opcion_altas.insertrow(0)
idw_opcion_bajas.insertrow(0)
idw_minutas.insertrow(0)
idw_final_obra.insertrow(0)
idw_garantias.insertrow(0)
idw_reclamaciones.insertrow(0)
idw_reparos.insertrow(0)
idw_registro_es.insertrow(0)
idw_otros_docs.insertrow(0)
idw_arquitectos.insertrow(0)
idw_opcion_residente.insertrow(0)
idw_tipo_actuacion_seleccion.insertrow(0)
idw_tipo_obra_seleccion.insertrow(0)
idw_destino_seleccion.insertrow(0)
idw_opcion_tarifas.insertrow(0)
idw_renuncias.insertrow(0)
idw_pagos_plataforma.insertrow(0)

idw_estados_contrato.retrieve()
idw_gestion_contrato.retrieve()
idw_modalidad_contrato.retrieve()
idw_colegio_dest.retrieve()
idw_agrupaciones.retrieve()
idw_sit_profesionales.retrieve()
idw_incompatibilidades.retrieve()
idw_situaciones.retrieve()
idw_t_alta.retrieve()
idw_t_baja.retrieve()

idw_otros_doc_contrato.retrieve()
idw_residente.retrieve()
idw_tipoact.retrieve()
idw_tipoobra.retrieve()
idw_destino.retrieve()
idw_principal.SetFocus()
idw_principal.SetColumn('n_expediente')

if g_colegio = 'COAATZ' then
	idw_tarifas.retrieve()
	tab_1.tabpage_11.visible = true	
end if

lb_is_not_initialized= true
end event

event pfc_postopen();call super::pfc_postopen;this.post event csd_oculta()
end event

type cb_recuperar_pantalla from w_listados`cb_recuperar_pantalla within w_fases_listados
integer x = 73
integer y = 2112
integer width = 503
integer height = 96
integer taborder = 30
string text = "&Recuperar Consulta"
end type

event cb_recuperar_pantalla::clicked;call super::clicked;parent.post event csd_oculta()
end event

type cb_guardar_pantalla from w_listados`cb_guardar_pantalla within w_fases_listados
integer x = 73
integer y = 2112
integer width = 503
integer height = 96
string text = "&Guardar Consulta"
end type

type cb_limpiar from w_listados`cb_limpiar within w_fases_listados
integer x = 3506
integer y = 1976
integer width = 475
integer height = 84
integer taborder = 60
integer textsize = -8
end type

type dw_listados_varios from w_listados`dw_listados_varios within w_fases_listados
integer x = 2729
integer y = 196
integer width = 1097
integer height = 2216
integer taborder = 160
end type

type cb_ver from w_listados`cb_ver within w_fases_listados
integer taborder = 50
end type

event cb_ver::clicked;call super::clicked;string sql,sql_aux, listado,exp,c1,c2,n
int i
string n_colegiado, n_nif, sql_copia
long fila_origen,fila_destino,ll_row
date f_entrada_desde,f_entrada_hasta
datetime ldt_aux

g_ultima_consulta = ''

idw_principal.AcceptText()
idw_estados_contrato.AcceptText()
idw_gestion_contrato.AcceptText()
idw_modalidad_contrato.AcceptText()
idw_colegio_dest.AcceptText()
idw_datos_agrupacion.AcceptText()
idw_datos_sitprof.AcceptText()
idw_agrupaciones.AcceptText()
idw_sit_profesionales.AcceptText()
idw_incompatibilidades.AcceptText()
idw_alta_si_no.AcceptText()
idw_situaciones.AcceptText()
idw_t_alta.AcceptText()
idw_t_baja.AcceptText()
idw_minutas.AcceptText()

idw_otros_docs.AcceptText()
idw_otros_doc_contrato.Accepttext()
idw_final_obra.Accepttext()
idw_garantias.Accepttext()
idw_reclamaciones.Accepttext()
idw_reparos.AcceptText()
idw_registro_es.AcceptText()
idw_arquitectos.AcceptText()
idw_residente.AcceptText()
idw_renuncias.accepttext()


// Asignar objeto dw en funcion de la fila seleccionada de la dw dw_listados_varios
listado = dw_listados_varios.GetItemString(dw_listados_varios.GetRow(),'dw')
dw_1.dataobject = listado
if listado='d_fases_listado_certif_na' then 
   if g_activa_multiempresa = 'S' then
      f_logo_empresa(g_empresa ,dw_1,'004') 
   end if
end if
sql=''

dw_1.of_SetTransObject(SQLCA)

isql_nuevo = dw_1.describe("datawindow.table.select")
sql_copia=isql_nuevo

i_exp=idw_principal.getitemstring(1,'n_expediente')
if i_exp='0' then
	i_exp=''
	i_resultado='mal'
	return
else
	i_resultado='ok'
end if


//Cambio Luis ICN-345 
if(listado = 'd_informe_visados_f_abono_na')then
	if(f_es_vacio(string(idw_principal.getitemdatetime(1,'f_abono_desde'))) or f_es_vacio(string(idw_principal.getitemdatetime(1,'f_abono_hasta'))))then
		MessageBox(g_titulo,'Debe de especificar un intervalo de fechas de abono para este listado')
		return
	else
	 	dw_1.retrieve(idw_principal.getitemdatetime(1,'f_abono_desde'),idw_principal.getitemdatetime(1,'f_abono_hasta'))
	end if
end if
//fin cambio



parent.triggerevent ('csd_consulta_principal')		
parent.triggerevent ('csd_consulta_pem_hono')		
parent.triggerevent ('csd_consulta_control')		
parent.triggerevent ('csd_consulta_estadistica')	

parent.triggerevent ('csd_consulta_colegiado')
parent.triggerevent ('csd_consulta_colegiado_col')


parent.triggerevent ('csd_consulta_minutas')
parent.triggerevent ('csd_consulta_otros_documentos')
parent.triggerevent ('csd_consulta_finales_obra')
parent.triggerevent ('csd_consulta_garantias')
parent.triggerevent ('csd_consulta_reclamaciones')
parent.triggerevent ('csd_consulta_reparos')
parent.triggerevent ('csd_consulta_registros')
parent.triggerevent ('csd_consulta_arquitectos')
parent.triggerevent ('csd_consulta_residente')
parent.TriggerEvent ('csd_consulta_tarifas')
parent.TriggerEvent ('csd_consulta_renuncia')

if listado = 'd_fases_listado_pagos_plataforma' then parent.TriggerEvent ('consulta_pagos_plataforma')


if isql_nuevo=sql_copia then 
	MessageBox(g_titulo,g_idioma.of_getmsg('msg_musaat.especificar_param_busqueda','Ha de especificar al menos un par$$HEX1$$e100$$ENDHEX$$metro de b$$HEX1$$fa00$$ENDHEX$$squeda'))
	return
end if

// Se prepara el formato del Nro. Expediente
if not f_es_vacio(idw_principal.getitemstring(1,'n_expediente')) then
	isql_nuevo=isql_nuevo + "and expedientes.n_expedi LIKE '" + i_exp + "%'"
end if


//Cambio Luis ICTL-179
if listado = 'd_fases_listado_por_coleg_ta_to_teb' then 
	if(f_es_vacio(idw_principal.getitemstring(1,'n_colegiado')))then 
		MessageBox(g_titulo,'Para este listado, se debe de especificar un n$$HEX1$$fa00$$ENDHEX$$mero de colegiado')
		return
	end if
end if
//fin cambio


if  listado <>  'd_listado_fases_mensuales_cc' and  listado <> 'd_listado_fases_mensuales_cc_admin' and  listado <> 'd_fases_listado_tipos_int_total' and listado <>'d_fases_listado_obras_liq_ext' and listado <>'d_fases_listado_obras_visadas' and listado <> 'd_informe_visados_f_abono_na' and listado<>'d_fases_listado_impagadas_180_dias' and listado<>'d_fases_listado_obras_pendientes_gc' and listado <> 'd_fases_listado_num_viv_cerrado' then 
  dw_1.Modify("DataWindow.Table.Select= ~"" + isql_nuevo + "~"")
  dw_1.SetTransobject(sqlca)
  dw_1.retrieve()
  ll_row = dw_1.rowcount()
end if

//Modificado Jesus 11/11/09 CRI-170
if listado='d_fases_listado_impagadas_180_dias' then
	ldt_aux = tab_1.tabpage_5.dw_minutas.getitemdatetime(1,'fechad')
	if ( NOT isNull( ldt_aux )) then
		dw_1.retrieve(Datetime(RelativeDate(Date(ldt_aux), -180)))
	else
		messagebox(g_titulo, 'Debe insertar una ~"Fecha Desde~" en Contrato Minutas para mostrar el listado')
		return
	end if
end if
//Fin modificado

if listado = 'd_fases_listado_por_tipoact_tipoobra' then
	dw_1.groupcalc()
	dw_1.sort()
end if
if listado = 'd_fases_listado_por_colegiado_pendientes' then
	dw_1.setfilter("honos_pendientes > 0 ")
	dw_1.filter()
	dw_1.groupcalc()
end if

if listado = 'd_fases_listado_interv_por_poblaciones' then
	isql_nuevo=isql_nuevo + "GROUP BY poblaciones.descripcion"
	dw_1.Modify("DataWindow.Table.Select= ~"" + isql_nuevo + "~"")
	dw_1.retrieve()
end if

//Luis CCU-65
if listado = 'd_fases_listado_num_viv_cerrado' then
	datetime f_ini, f_fin
	
	f_ini = idw_principal.getitemdatetime(1,'f_cfo_desde')
	f_fin = idw_principal.getitemdatetime(1,'f_cfo_hasta')
	if(f_es_vacio(string(f_ini)) or f_es_vacio(string(f_fin)))then
		MessageBox(g_titulo,'Este listado se debe consultar por la fecha desde y fecha hasta de C.F.O')
		return
	end if
	dw_1.retrieve(f_ini,f_fin)
end if
//fin cambio


if listado = 'd_fases_listado_tipos_int_total' then
	isql_nuevo=isql_nuevo + "GROUP BY  datename  (  year  ,   fases.f_entrada), datepart  (  month  ,   fases.f_entrada),  delegaciones.cod_delegacion,  t_fases.c_t_fase"
		dw_1.Modify("DataWindow.Table.Select= ~"" + isql_nuevo + "~"")
	dw_1.retrieve()

end if  

// Listado Obras Tarragona/Gran Canaria
if(g_colegio = 'COAATTGN' or g_colegio = 'COAATTEB' or g_colegio = 'COAATGC' OR g_colegio='COAATLL')then
	long k,j
	string codigo, estado = 'S', renunciado, id_fase, activo, id_col
	if listado = 'd_fases_listado_obras_tg' or listado = 'd_fases_listado_obras_gc' then
		for j = 1 to dw_1.rowcount()
			for k = 1 to  idw_estados_contrato.rowcount( )
				id_fase = dw_1.getitemstring(j,'id_fase')
				select estado into :codigo from fases where id_fase = :id_fase;
				if(codigo = '61' or codigo = '62' or codigo = '63' or codigo = '64' or codigo = '65' or codigo = '66')then
					estado = 'N'
				end if
			next
			if(estado = 'S')then
				id_fase = dw_1.getitemstring(j,'id_fase')
				id_col = dw_1.getitemstring(j,'colegiados_id_colegiado')
				select renunciado into :renunciado from fases_colegiados where id_fase = :id_fase and id_col = :id_col;
				if(renunciado = 'S')then
					estado = 'N'
				end if
			end if
			dw_1.setitem(j,'estado_obra',estado)
			if( listado = 'd_fases_listado_obras_gc' and estado = 'N')then
				dw_1.deleterow(j)
			end if
			estado = 'S'
		next
	end if
end if

// LISTADO VISADOS MENSUALES

if listado = 'd_listado_fases_mensuales_cc'  or listado = 'd_listado_fases_mensuales_cc_admin' then
	string delegacion,codigo_delegacion,expedientes_id_expedi,nom_delegacion,texto, anyo_d, texto2, texto3
	long visados,num_delegaciones,jj,anyo,fila_visado,mes,ii,meses,suma_meses
	date f_entrada
	datetime fases_f_entrada, f_visado_desde, f_visado_hasta
	double parcial,total_mes,total_meses, suma_total

		meses = 0
		suma_meses =0 
		if listado = 'd_listado_fases_mensuales_cc' then
			anyo_d =  string(year(date(idw_principal.getitemdatetime(1,"f_visado_hasta"))))
			f_visado_desde =datetime('01-01-'+anyo_d)
			f_visado_hasta =datetime(date(idw_principal.getitemdatetime(1,'f_visado_hasta')), time('23:59:59'))
		else
			anyo_d =  string(year(date(idw_principal.getitemdatetime(1,"f_abono_hasta"))))
			f_visado_desde =datetime('01-01-'+anyo_d)
			f_visado_hasta =datetime(date(idw_principal.getitemdatetime(1,'f_abono_hasta')), time('23:59:59'))
		end if
	
datastore ds_visados
ds_visados = create datastore
if listado = 'd_listado_fases_mensuales_cc' then ds_visados.dataobject = "d_visados_entre_fechas"
if listado = 'd_listado_fases_mensuales_cc_admin' then ds_visados.dataobject = "d_visados_entre_fechas_vis_admin"
ds_visados.settransobject( SQLCA)
ds_visados.retrieve(f_visado_desde,f_visado_hasta )

datastore ds_delegaciones
ds_delegaciones = create datastore
ds_delegaciones.dataobject = "d_delegaciones"
ds_delegaciones.settransobject( SQLCA)
ds_delegaciones.retrieve( )
	
total_meses = ds_visados.rowcount()
	
texto = ''
texto2 = ''
texto3 = ''

if year(date(f_visado_hasta)) = year(date(f_visado_desde)) then
  anyo = year(date(f_visado_desde))
  


	for jj = 1 to ds_delegaciones.rowcount()
        codigo_delegacion = ds_delegaciones.getitemstring(jj,'cod_delegacion')
		  nom_delegacion = ds_delegaciones.getitemstring(jj,'descripcion')
		 ds_visados.setfilter("modalidad = '" + string(codigo_delegacion)+ "'")	
          ds_visados.filter()
//			 texto = texto +'    ' +  nom_delegacion + ' : ' + string(ds_visados.rowcount()) + '     ' + string(dec(ds_visados.rowcount() * 100 / total_meses), '###,###.00') +'% ' + cr
		texto = texto +'    ' +  nom_delegacion + ' : '   + cr
		texto2= texto2 +'    '+ string(ds_visados.rowcount())+ cr+cr
		texto3= texto3 +'    '+ string(dec((ds_visados.rowcount() * 100) / total_meses), '###,###.00') +'% ' +cr+cr
	next

      




	for ii= 1 to 12
		// COMPROBAMOS TOTAL DEL MES
		if listado = 'd_listado_fases_mensuales_cc' then 
			ds_visados.setsort('f_visado')
			ds_visados.setfilter('month(f_visado)= ' + string(ii))
		else
			ds_visados.setsort('f_abono')
			ds_visados.setfilter('month(f_abono)= ' + string(ii))
		end if 
		ds_visados.sort()
		ds_visados.filter()

		total_mes = ds_visados.rowcount()
		//dw_1.setitem(fila_visado,'total',total_meses)
		//total_meses = total_meses + total_mes

	for jj = 1 to ds_delegaciones.rowcount()
        codigo_delegacion = ds_delegaciones.getitemstring(jj,'cod_delegacion')
	    nom_delegacion = ds_delegaciones.getitemstring(jj,'descripcion')
	 //ds_visados.setfilter('month(fases_f_entrada)= ' + string(ii) + " and modalidad = '" + string(codigo_delegacion)+ "'")	
	 if listado = 'd_listado_fases_mensuales_cc' then 
		ds_visados.setfilter('month(f_visado)= ' + string(ii) + " and modalidad = '" + string(codigo_delegacion)+ "'")	
	else
		ds_visados.setfilter('month(f_abono)= ' + string(ii) + " and modalidad = '" + string(codigo_delegacion)+ "'")	
	end if
		ds_visados.filter()
		fila_visado = dw_1.insertrow(0)
		dw_1.setitem(fila_visado,'suma_parcial',total_meses)
		dw_1.setitem(fila_visado,'anyo',anyo)
		//total_meses = ds_visados.rowcount()
		//delegacion = ds_visados.getitemstring(jj,'modalidad')
		//fases_f_entrada = ds_visados.getitemdatetime(jj,'fases_f_entrada')
		parcial = ds_visados.rowcount()
		dw_1.setitem(fila_visado,'cod_mes',string(ii))
		dw_1.setitem(fila_visado,'cod_delegacion',codigo_delegacion)
		dw_1.setitem(fila_visado,'delegacion',nom_delegacion)
		dw_1.setitem(fila_visado,'parcial',parcial)


		if jj = 1 then
		dw_1.setitem(fila_visado,'cod_mes',right('00 ' + string(ii),2))
		else
			dw_1.setitem(fila_visado,'cod_mes','00')
		end if
		
		if total_mes <> 0 then
			dw_1.setitem(fila_visado,'porcentaje',(parcial * 100) / total_mes)
			suma_meses = suma_meses + 1
			dw_1.setitem(fila_visado,'meses2',suma_meses)
		end if
		
		if total_mes <> 0 and jj = ds_delegaciones.rowcount() and total_meses <> 0 then
			if parcial <> 0 then 
				dw_1.setitem(fila_visado,'total_porc',(total_mes * 100) / total_meses)
				dw_1.setitem(fila_visado,'total_parcial',total_mes)
				meses =  1
				dw_1.setitem(fila_visado,'meses',meses)
			end if
		else
			meses = 0
			dw_1.setitem(fila_visado,'meses',meses)
		end if
		ds_visados.setfilter('')	
		ds_visados.filter()
	
   next

	
next
dw_1.setitem(fila_visado,'suma_total_p',total_meses)
dw_1.setitem(fila_visado,'texto',texto)
dw_1.setitem(fila_visado,'texto2',texto2)
dw_1.setitem(fila_visado,'texto3',texto3)
else
  MessageBox('ATENCION','Solo se puede visualizar valores con el mismo ejercicio.')
  return
end if

end if




if listado = 'd_fases_listado_obras_liq_ext'  OR listado = 'd_fases_listado_obras_visadas' then

   string organismo,uno,codigo_ext,tipodocum,expediente,colegiado,coelgiado2,lugar,orden,tipo,titular,titular2,poblacion,id_fase_ext,fecha_visado
   string nom_colegiado1,nom_colegiado2,ape_colegiado1,ape_colegiado2,nom_cli1,nom_cli2,ape_cli1,ape_cli2
   datetime	 fechas
	
   datastore ds_obras
   ds_obras = create datastore
   
	//Modificado Jesus 18-01-2010 cav-84
   if(listado = 'd_fases_listado_obras_liq_ext') then 
	if (g_colegio = 'COAATAVI') then
		ds_obras.dataobject = "d_fases_obras_liq_cfo"    // fechas sera f_cfo
		f_entrada_desde = date(idw_principal.getitemdatetime(1,"f_cfo_desde"))
    		f_entrada_hasta =date( idw_principal.getitemdatetime(1,"f_cfo_hasta"))
	else
   		ds_obras.dataobject = "d_fases_obras_liq"    // fechas sera f_visado
		f_entrada_desde = date(idw_principal.getitemdatetime(1,"f_entrada_desde"))
    		f_entrada_hasta =date( idw_principal.getitemdatetime(1,"f_entrada_hasta"))
	end if
   end if

  if( listado = 'd_fases_listado_obras_visadas' ) then
	ds_obras.dataobject = "d_fases_obras_visado"    //fechas sera f_abono
	 f_entrada_desde = date(idw_principal.getitemdatetime(1,"f_abono_desde"))
       f_entrada_hasta =date( idw_principal.getitemdatetime(1,"f_abono_hasta"))
  end if
	
	
   datastore ds_fases_colegiados
   ds_fases_colegiados = create datastore
   ds_fases_colegiados.dataobject = "d_fases_colegiados_liq" 
	
   datastore ds_fases_clientes
   ds_fases_clientes = create datastore
   ds_fases_clientes.dataobject = "d_fases_clientes" 
	
	
	ds_fases_colegiados.settransobject(SQLCA)
	ds_fases_clientes.settransobject(SQLCA)
	ds_obras.settransobject(SQLCA)
	ds_obras.retrieve(f_entrada_desde,f_entrada_hasta)
	
	organismo = "Colegio Oficial Aparejadores y Arquitectos T$$HEX1$$e900$$ENDHEX$$cnicos"
	uno = "Expedientes"

for fila_origen = 1 to ds_obras.rowcount()
	codigo_ext=   ds_obras.getitemstring(fila_origen,'t_fases_c_t_fase')               
    tipo =  ds_obras.getitemstring(fila_origen,'trabajos_d_trabajo')               
	fechas = 	ds_obras.getitemdatetime(fila_origen,'fechas')  
	expediente =  ds_obras.getitemstring(fila_origen,'fases_archivo')                 
	lugar =  ds_obras.getitemstring(fila_origen,'fases_emplazamiento')                  
	poblacion = ds_obras.getitemstring(fila_origen,'poblaciones_descripcion')                  
	tipo = ds_obras.getitemstring(fila_origen,'fases_descripcion')                  
	id_fase_ext  = ds_obras.getitemstring(fila_origen,'fases_id_fase')               
		
	
	ds_fases_colegiados.retrieve(id_fase_ext)
	ds_fases_clientes.retrieve(id_fase_ext)
   	long f_col
	nom_colegiado2 = ''
    ape_colegiado2 = ''
   nom_cli2 = ''
	ape_cli2 = ''
 coelgiado2 = ''
 titular2 = ''
	
	for f_col = 1 to ds_fases_colegiados.rowcount()
		if f_col = 1 then
	 	 nom_colegiado1 = ds_fases_colegiados.getitemstring(f_col,"colegiados_nombre")
	 	 ape_colegiado1 = ds_fases_colegiados.getitemstring(f_col,"colegiados_apellidos")	
		  if isnull(nom_colegiado1) then nom_colegiado1 = ''
  		  if isnull(ape_colegiado1) then ape_colegiado1 = ''
		if( listado = 'd_fases_listado_obras_visadas' and g_colegio = 'COAATAVI') then			 
			colegiado = nom_colegiado1 + ' ' + ape_colegiado1  
		else
			colegiado = ape_colegiado1 + ' ,' + nom_colegiado1
		end if	
	elseif f_col = 2 then
		nom_colegiado2 = ds_fases_colegiados.getitemstring(f_col,"colegiados_nombre")
       ape_colegiado2 = ds_fases_colegiados.getitemstring(f_col,"colegiados_apellidos")	
		 if isnull(nom_colegiado2) then nom_colegiado1 = ''
  		 if isnull(ape_colegiado2) then ape_colegiado1 = ''
		if( listado = 'd_fases_listado_obras_visadas' and g_colegio = 'COAATAVI') then 	
			coelgiado2 = nom_colegiado2 + ' ' +  ape_colegiado2 
		else
		 coelgiado2 = ape_colegiado2 + ' ,' + nom_colegiado2
		end if 
	end if
next

	for f_col = 1 to ds_fases_clientes.rowcount()
		if f_col = 1 then
	 	nom_cli1 = ds_fases_clientes.getitemstring(f_col,"clientes_nombre")
	 	ape_cli1 = ds_fases_clientes.getitemstring(f_col,"clientes_apellidos")	
		if isnull(nom_cli1) then nom_cli1 = ''
  		if isnull(ape_cli1) then ape_cli1 = ''
		if( listado = 'd_fases_listado_obras_visadas' and g_colegio = 'COAATAVI') then
			titular = nom_cli1 + ' ' + ape_cli1
		else
			titular = nom_cli1 + ' ,' + ape_cli1
		end if
	elseif f_col = 2 then
		nom_cli2 = ds_fases_clientes.getitemstring(f_col,"clientes_nombre")
       ape_cli2 = ds_fases_clientes.getitemstring(f_col,"clientes_apellidos")	
		if isnull(nom_cli2) then nom_cli2 = ''
  		if isnull(ape_cli2) then ape_cli2 = ''
		if( listado = 'd_fases_listado_obras_visadas' and g_colegio = 'COAATAVI') then	
		 	titular2 = nom_cli2 + ' ' + ape_cli2  
		else 
			titular2 = ape_cli2 + ' ,' + nom_cli2
		end if
	end if
     		
	
    next		
	 fila_destino = dw_1.insertrow(0)

	// Para $$HEX1$$c100$$ENDHEX$$vila s$$HEX1$$f300$$ENDHEX$$lo quieren que se escriba el a$$HEX1$$f100$$ENDHEX$$o en la exportaci$$HEX1$$f300$$ENDHEX$$n 
	if( listado = 'd_fases_listado_obras_visadas' and g_colegio = 'COAATAVI') then 
		dw_1.setitem(fila_destino,"fechas",string(year(date(fechas))))
	else 
		dw_1.setitem(fila_destino,"fechas",fechas)
	end if
	dw_1.setitem(fila_destino,"organismo",organismo) 
      dw_1.setitem(fila_destino,"uno",uno) 
	dw_1.setitem(fila_destino,"colegiado",colegiado)
	dw_1.setitem(fila_destino,"colegiado2",coelgiado2)
	dw_1.setitem(fila_destino,"titular",titular)
	dw_1.setitem(fila_destino,"titular2",titular2)
	
	tipodocum = ''
	if codigo_ext = '13' or codigo_ext = '14' or codigo_ext = '16' or codigo_ext = '17' or codigo_ext = '53' or codigo_ext = '54 ' then
	  	codigo_ext = '1.1'
		tipodocum = 'Direccion de obra'
	elseif codigo_ext = '41' or codigo_ext = '42' or codigo_ext = '43' or codigo_ext = '45' or codigo_ext = '56' or codigo_ext = '61 '  &
		or codigo_ext = '62' or codigo_ext = '63'or codigo_ext = '64'or codigo_ext = '65'or codigo_ext = '66' or codigo_ext = '71'  & 
	or codigo_ext = '72' or codigo_ext = '73'or codigo_ext = '742' or codigo_ext = '75' or codigo_ext = '91' or codigo_ext = '92' & 
	or codigo_ext = '93' or codigo_ext = '94'or codigo_ext = '95' or codigo_ext = '31' or codigo_ext = '33' or codigo_ext = '81' or codigo_ext = '83'then
 	codigo_ext = '1.3'
	tipodocum = 'Informes'
elseif codigo_ext = '52' or codigo_ext = '11' or codigo_ext = '12' or codigo_ext = '15' or codigo_ext = '51' then
	codigo_ext = '1.4'
	tipodocum = 'Proyectos'

elseif codigo_ext = '01' or codigo_ext = '02' or codigo_ext = '04' or codigo_ext = '05'  then
	codigo_ext = '1.2.2'
	tipodocum = 'Estudios'

elseif codigo_ext = '03'  then
	codigo_ext = '1.2.1'
	tipodocum = 'Coordinacion'
	
end if
		
	dw_1.setitem(fila_destino,"codigo", codigo_ext)	
	dw_1.setitem(fila_destino,"tipodocum",tipodocum)
	dw_1.setitem(fila_destino,"lugar",poblacion)
    dw_1.setitem(fila_destino,"orden",poblacion + '  ' + lugar)
 	dw_1.setitem(fila_destino,"expediente",expediente)
 	dw_1.setitem(fila_destino,"tipo",tipo)
    dw_1.setitem(fila_destino,"sign",'')	 
    dw_1.setitem(fila_destino,"contenido",'')	 	 
    dw_1.setitem(fila_destino,"notas",'')	 	 
    dw_1.setitem(fila_destino,"signatura",'')	 	 
next
		
end if

//Luis CCU-65
if listado = 'd_fases_listado_num_viv_cerrado' then
	cb_1.visible = true
end if

// Al final:
if dw_1.rowcount() > 0 then

	if dw_1.dataobject = 'ds_fases_listado_completo' then wf_rellenar_listado(dw_1) // Listado externo
	dw_1.visible 		  = true
	// No tiene reports, hacer el printpreview		
	if dw_1.Describe("DataWindow.Nested") = "no" then dw_1.event pfc_printpreview()
	if dw_1.describe("t_parametros.name") = "t_parametros" then dw_1.object.t_parametros.text = g_ultima_consulta			
	this.enabled        = false
	cb_zoom.enabled     = true
	cb_imprimir.enabled = true
	cb_guardar.enabled  = true
	cb_escala.enabled  = true
	cb_ordenar.enabled  = true
else
	messagebox(g_titulo,g_idioma.of_getmsg('msg_cobros.no_encontrado_registros','No se han encontrado registros segun las especificaciones.'))
end if



end event

type cb_salir from w_listados`cb_salir within w_fases_listados
integer taborder = 140
end type

type dw_listados from w_listados`dw_listados within w_fases_listados
event csd_borrar_codigos ( )
boolean visible = false
integer x = 3360
integer y = 24
integer width = 283
integer height = 184
integer taborder = 40
string dataobject = "d_fases_consulta"
end type

event dw_listados::csd_borrar_codigos();//dw_listados.setitem(1,message.stringparm,'')
//setcolumn(i_tab)
end event

event dw_listados::constructor;call super::constructor;//this.of_SetDropDownCalendar(True)
//this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
//this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
//this.iuo_calendar.of_SetInitialValue(True)
//
//
//this.setformat('f_inicio_desde','dd/mm/yyyy')
//this.setformat('f_cierre_desde','dd/mm/yyyy')
//this.setformat('f_contrato_desde','dd/mm/yyyy')
//
//this.setformat('f_inicio_hasta','dd/mm/yyyy')
//this.setformat('f_cierre_hasta','dd/mm/yyyy')
//this.setformat('f_contrato_hasta','dd/mm/yyyy')

end event

event dw_listados::itemchanged;//integer i
//string cod
//cod='***'
//choose case dwo.name
//	case 'n_expediente'
//		i_exp=data
//		if i_exp='0' then
//			i_exp=''
//			i_resultado='mal'
//		else
//			i_resultado='ok'
//		end if
//	case 'tipo_trabajo'
//		SELECT tipos_trabajos.c_t_trabajo INTO :cod FROM tipos_trabajos WHERE tipos_trabajos.c_t_trabajo = :data;
//		i_tab=getcolumn()
//	case 'trabajo'	
//		SELECT trabajos.c_trabajo INTO :cod FROM trabajos WHERE trabajos.c_trabajo = :data ;
//		i_tab=getcolumn()
//	case 'poblacion'
//		SELECT poblaciones.cod_pob INTO :cod FROM poblaciones WHERE poblaciones.cod_pob = :data ;
//		i_tab=getcolumn()
//end choose
//
//if cod<>'***' and not isnull(cod) then
//	MessageBox(g_titulo,'Este c$$HEX1$$f300$$ENDHEX$$digo no existe.')
//	message.stringparm=string(dwo.name)
//	postevent ("csd_borrar_codigos")
//end if
end event

event dw_listados::buttonclicked;call super::buttonclicked;//string id_col, id_cliente
//string pob
//
//choose case dwo.name
//	case "b_busca_colegiado"
//  		g_busqueda.titulo="B$$HEX1$$fa00$$ENDHEX$$squeda r$$HEX1$$e100$$ENDHEX$$pida de Colegiados"
//		g_busqueda.dw="d_lista_busqueda_colegiados"
//		id_col=f_busqueda_colegiados()   
//		if NOT f_es_vacio(id_col)  then
//			this.setitem(this.getrow(),'n_colegiado',f_colegiado_n_col(id_col))
////			 this.setitem(this.getrow(),'nombre_colegiado',f_colegiado_apellido(id_col))
////		else
////			this.setitem(this.getrow(),'n_colegiado',"")
////			this.setitem(this.getrow(),'nombre_colegiado',"")
//		end if
//
//case "b_busca_cliente"
//	g_busqueda.titulo="B$$HEX1$$fa00$$ENDHEX$$squeda r$$HEX1$$e100$$ENDHEX$$pida de clientes"
//	g_busqueda.dw="d_lista_busqueda_clientes"
//	id_cliente=f_busqueda_clientes("")
//	if NOT f_es_vacio(id_cliente)  then
//		this.setitem(this.getrow(),'nif_promotor',f_dame_nif(id_cliente))
//	//	this.setitem(this.getrow(),'nombre_promotor',f_dame_cliente(id_cliente))
////	else
////		this.setitem(this.getrow(),'nif_promotor',"")
////		this.setitem(this.getrow(),'nombre_promotor',"")
//	end if
//
//
//	CASE 'bb_poblacion'
//		g_busqueda.titulo='Poblaciones'
//		g_busqueda.dw='d_poblaciones_lista_busqueda'
//		pob=f_busqueda_poblaciones()
//		if f_es_vacio(pob) then return
//		this.SetItem(1,'poblacion',pob)
//
//END CHOOSE
end event

event dw_listados::csd_oculta;call super::csd_oculta;string listado

listado = dw_listados_varios.GetItemString(dw_listados_varios.GetRow(),'dw')

if lb_is_not_initialized then 
	idw_pagos_plataforma.visible = false

	if listado = 'd_fases_listado_pagos_plataforma' then idw_pagos_plataforma.visible = true
end if	

end event

type cb_imprimir from w_listados`cb_imprimir within w_fases_listados
integer taborder = 110
end type

type cb_zoom from w_listados`cb_zoom within w_fases_listados
integer taborder = 70
end type

type cb_esp from w_listados`cb_esp within w_fases_listados
integer taborder = 120
end type

type cb_guardar from w_listados`cb_guardar within w_fases_listados
integer taborder = 130
end type

event cb_guardar::clicked;int i,j,ls_return
string ls_fase,listado,clientesl
datastore clientes
listado=dw_listados_varios.GetItemString(dw_listados_varios.GetRow(),'dw') 
if listado ='d_fases_listado_por_colegiado_exp'   or listado = 'd_fases_list_por_col_certif_exp'  then

				clientes = create datastore
				clientes.DataObject = 'd_fases_clientes_listados'
				clientes.SetTransObject(SQLCA)
				//lleno con los clientes
				for i=1 to dw_1.rowcount()
					clientesl=""
					ls_fase=dw_1.GetItemString(i,'id_fase')
 					clientes.Retrieve(ls_fase)
					 
					 for j=1 to clientes.RowCount()
						if clientesl="" then
							clientesl=clientes.GetItemString(j, 'compute_1')+" "+clientes.GetItemString(j, 'compute_2')
						else
						clientesl=clientesl+";"+clientes.GetItemString(j, 'compute_1')+" "+clientes.GetItemString(j, 'compute_2')
					end if
					 next
					 dw_1.SetItem( i, 'clientes',clientesl)	
		 
				next
	

		//Una vez relleno, se guarda
		ls_return = dw_1.saveas()
		if ls_return <> 1 then
			messagebox (g_titulo, 'Ha ocurrido un error al guardar el fichero!')
		end if
else
		ls_return = dw_1.saveas()
		if ls_return <> 1 then
			messagebox (g_titulo, 'Ha ocurrido un error al guardar el fichero!')
		end if
end if


end event

type cb_escala from w_listados`cb_escala within w_fases_listados
integer taborder = 80
end type

type cb_ordenar from w_listados`cb_ordenar within w_fases_listados
integer taborder = 90
end type

type dw_listados_titulo from w_listados`dw_listados_titulo within w_fases_listados
integer x = 5
integer y = 2244
integer width = 3392
integer taborder = 100
end type

type dw_1 from w_listados`dw_1 within w_fases_listados
integer x = 9
integer y = 180
integer width = 3845
integer height = 2240
integer taborder = 150
boolean ib_isupdateable = false
end type

type tab_1 from tab within w_fases_listados
integer x = 14
integer y = 184
integer width = 2679
integer height = 2240
integer taborder = 20
boolean bringtotop = true
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long backcolor = 79741120
boolean multiline = true
boolean raggedright = true
boolean focusonbuttondown = true
integer selectedtab = 1
tabpage_1 tabpage_1
tabpage_5 tabpage_5
tabpage_9 tabpage_9
tabpage_2 tabpage_2
tabpage_7 tabpage_7
tabpage_6 tabpage_6
tabpage_8 tabpage_8
tabpage_3 tabpage_3
tabpage_4 tabpage_4
tabpage_10 tabpage_10
tabpage_11 tabpage_11
end type

on tab_1.create
this.tabpage_1=create tabpage_1
this.tabpage_5=create tabpage_5
this.tabpage_9=create tabpage_9
this.tabpage_2=create tabpage_2
this.tabpage_7=create tabpage_7
this.tabpage_6=create tabpage_6
this.tabpage_8=create tabpage_8
this.tabpage_3=create tabpage_3
this.tabpage_4=create tabpage_4
this.tabpage_10=create tabpage_10
this.tabpage_11=create tabpage_11
this.Control[]={this.tabpage_1,&
this.tabpage_5,&
this.tabpage_9,&
this.tabpage_2,&
this.tabpage_7,&
this.tabpage_6,&
this.tabpage_8,&
this.tabpage_3,&
this.tabpage_4,&
this.tabpage_10,&
this.tabpage_11}
end on

on tab_1.destroy
destroy(this.tabpage_1)
destroy(this.tabpage_5)
destroy(this.tabpage_9)
destroy(this.tabpage_2)
destroy(this.tabpage_7)
destroy(this.tabpage_6)
destroy(this.tabpage_8)
destroy(this.tabpage_3)
destroy(this.tabpage_4)
destroy(this.tabpage_10)
destroy(this.tabpage_11)
end on

type tabpage_1 from userobject within tab_1
string tag = "texto=fases.contrato_prinicpal"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Contrato Principal"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
lb_1 lb_1
st_1 st_1
dw_pem_hono dw_pem_hono
dw_principal dw_principal
end type

on tabpage_1.create
this.lb_1=create lb_1
this.st_1=create st_1
this.dw_pem_hono=create dw_pem_hono
this.dw_principal=create dw_principal
this.Control[]={this.lb_1,&
this.st_1,&
this.dw_pem_hono,&
this.dw_principal}
end on

on tabpage_1.destroy
destroy(this.lb_1)
destroy(this.st_1)
destroy(this.dw_pem_hono)
destroy(this.dw_principal)
end on

type lb_1 from listbox within tabpage_1
boolean visible = false
integer x = 2053
integer y = 180
integer width = 402
integer height = 60
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 33554432
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type st_1 from statictext within tabpage_1
boolean visible = false
integer x = 2053
integer y = 120
integer width = 343
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 33554432
long backcolor = 67108864
string text = "Asociados"
boolean focusrectangle = false
end type

type dw_pem_hono from u_dw within tabpage_1
integer x = 32
integer y = 1784
integer width = 2606
integer height = 248
integer taborder = 50
string dataobject = "d_fases_consulta_pem_hono"
boolean border = false
boolean ib_isupdateable = false
end type

type dw_principal from u_dw within tabpage_1
integer x = 32
integer y = 12
integer width = 2606
integer height = 1768
integer taborder = 10
string dataobject = "d_fases_consulta_principal"
boolean border = false
boolean ib_isupdateable = false
end type

event buttonclicked;call super::buttonclicked;string id_col, id_cliente
string pob, ls_anterior
int li_i, li_col 

choose case dwo.name
	case "b_busca_colegiado"
  		g_busqueda.titulo="B$$HEX1$$fa00$$ENDHEX$$squeda r$$HEX1$$e100$$ENDHEX$$pida de Colegiados"
		g_busqueda.dw="d_lista_busqueda_colegiados"
		id_col=f_busqueda_colegiados()   
		if NOT f_es_vacio(id_col)  then
			this.setitem(1,'n_colegiado',f_colegiado_n_col(id_col))
			
			///* Alexis. Modificado para habilitar la b$$HEX1$$fa00$$ENDHEX$$squeda de colegiados de una sociedad.01/02/2010 */
			if f_colegiado_es_sociedad(id_col) then
				dw_principal.object.b_busca_colegiados_sociedades.visible = 1
				st_1.visible = True
				lb_1.visible = True
				ist_fases_col_soc.id_sociedad = id_col
			else 
				dw_principal.object.b_busca_colegiados_sociedades.visible = 0
				st_1.visible = True
				lb_1.visible = True
				ist_fases_col_soc.id_sociedad = ''				
			end if	
			///* Fin modificado por Alexis	
			
		end if

case "b_busca_cliente"
	g_busqueda.titulo="B$$HEX1$$fa00$$ENDHEX$$squeda r$$HEX1$$e100$$ENDHEX$$pida de clientes"
	g_busqueda.dw="d_lista_busqueda_clientes"
	id_cliente=f_busqueda_clientes("")
	if NOT f_es_vacio(id_cliente)  then
		this.setitem(1,'nif_promotor',f_dame_nif(id_cliente))
	end if


	CASE 'bb_poblacion'
		g_busqueda.titulo='Poblaciones'
		g_busqueda.dw='d_poblaciones_lista_busqueda'
		ls_anterior = g_bloqueo_fases
		g_bloqueo_fases = 'S'
		pob=f_busqueda_poblaciones()
		g_bloqueo_fases = ls_anterior
		if f_es_vacio(pob) then return
		this.SetItem(1,'poblacion',pob)
		

	///* Case creado por Alexis el 01/02/2010 ***///
	case "b_busca_colegiados_sociedades"
		
		g_busqueda.titulo = 'Selecci$$HEX1$$f300$$ENDHEX$$n de colegiados pertenecientes a una sociedad'
		if f_colegiado_es_sociedad(f_colegiado_id_col(dw_principal.getitemstring(dw_principal.getrow(),'n_colegiado' ))) then
			openwithparm(w_fases_busqueda_coleg_sociedades, ist_fases_col_soc.id_sociedad)
			 
			if not isnull(message.powerobjectparm) then
				ist_fases_col_soc = message.powerobjectparm
				
				lb_1.reset()
				li_col = UpperBound(ist_fases_col_soc.id_colegiados)
				For li_i = 1 To li_col
					lb_1.additem(f_colegiado_n_col(ist_fases_col_soc.id_colegiados[li_i] ))
				next	
				
			end if	
			
		end if	

END CHOOSE
end event

event constructor;call super::constructor;this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)

end event

event itemchanged;call super::itemchanged;integer i, li_i, li_col
string cod,exp, ls_id_col
boolean sw
cod='***'
choose case dwo.name
	case 'n_expediente'
		i_exp=data
		if i_exp='0' then
			i_exp=''
			i_resultado='mal'
		else
			i_resultado='ok'
		end if
	case 'n_registro'

		case 'tipo_trabajo'
			SELECT tipos_trabajos.c_t_trabajo INTO :cod FROM tipos_trabajos WHERE tipos_trabajos.c_t_trabajo = :data;
			sw=true
		case 'trabajo'	
			SELECT trabajos.c_trabajo INTO :cod FROM trabajos WHERE trabajos.c_trabajo = :data ;
			sw=true
		case 'poblacion'
			SELECT poblaciones.cod_pob INTO :cod FROM poblaciones WHERE poblaciones.cod_pob = :data ;
			sw=true
		case 'estado'
			SELECT expedientes_estado.descripcion INTO :cod FROM expedientes_estado  
   			WHERE expedientes_estado.cod_estado = :data;
			sw=true
		case 'tipo_gestion'
			SELECT t_gestion.descripcion INTO :cod FROM t_gestion
					WHERE t_gestion.cod_gestion = :data;
			sw=true	
			
		CASE 't_descr'
		this.setitem(1, 'descripcion', data)	
		
		CASE 'n_colegiado'
		ls_id_col = f_colegiado_id_col(data)
		if f_colegiado_es_sociedad(ls_id_col) then
			dw_principal.object.b_busca_colegiados_sociedades.visible = 1
			st_1.visible = True
			lb_1.visible = True
			ist_fases_col_soc.id_sociedad = ls_id_col
		else 
			dw_principal.object.b_busca_colegiados_sociedades.visible = 0
			st_1.visible = False
			lb_1.visible = False
			ist_fases_col_soc.id_sociedad = ''				
		end if	
		if dw_principal.getitemstring(dw_principal.getrow(),  'n_colegiado') <> data then
			li_col = UpperBound(ist_fases_col_soc.id_colegiados)
			For li_i = 1 To li_col
				setnull(ist_fases_col_soc.id_colegiados[li_i])
			next	
			
			lb_1.reset()
			
		end if
		
	end choose
	
	if cod='***' and sw=true then
		MessageBox(g_titulo,g_idioma.of_getmsg('fases.msg_codigo_inexistente','Este c$$HEX1$$f300$$ENDHEX$$digo no existe.'))
		message.stringparm=string(dwo.name)
		postevent ("csd_borrar_codigos")
	end if
end event

event itemerror;call super::itemerror;// messagebox(g_titulo,'La informaci$$HEX1$$f300$$ENDHEX$$n introducida en alg$$HEX1$$fa00$$ENDHEX$$n par$$HEX1$$e100$$ENDHEX$$metro es incorrecta')
return 1
end event

event itemfocuschanged;call super::itemfocuschanged;choose case dwo.name
	case 'n_expediente'
	case else
		idw_principal.setitem(1,'n_expediente',i_exp)
end choose


end event

type tabpage_5 from userobject within tab_1
string tag = "texto=fases.contrato_minutas"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Contrato Minutas"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_minutas dw_minutas
end type

on tabpage_5.create
this.dw_minutas=create dw_minutas
this.Control[]={this.dw_minutas}
end on

on tabpage_5.destroy
destroy(this.dw_minutas)
end on

type dw_minutas from u_dw within tabpage_5
integer x = 14
integer y = 36
integer width = 2597
integer height = 1676
integer taborder = 31
string dataobject = "d_fases_consulta_minutas"
boolean border = false
boolean ib_isupdateable = false
end type

event buttonclicked;call super::buttonclicked;//int i
//choose case dwo.name
//	case 'b_1'
//		for i=1 to idw_gestion_contrato_minutas.rowcount() 
//			idw_gestion_contrato_minutas.SetItem(i,'activo','S')
//		next
//	case 'b_2'
//		for i=1 to idw_gestion_contrato_minutas.rowcount() 
//			idw_gestion_contrato_minutas.SetItem(i,'activo','N')
//		next		
//end choose
end event

event constructor;call super::constructor;this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)

end event

event itemchanged;call super::itemchanged;//choose case dwo.name
//	case 'tipo_gestion'
//	if data ='S' then
//		idw_gestion_contrato_minutas.visible = true
//	else
//		idw_gestion_contrato_minutas.visible=false
//	end if 
//end choose
end event

type tabpage_9 from userobject within tab_1
string tag = "texto=menu.estadisticas"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Estad$$HEX1$$ed00$$ENDHEX$$sticas"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
cb_borrar3_est cb_borrar3_est
cb_todos3_est cb_todos3_est
cb_borrar2_est cb_borrar2_est
cb_todos2_est cb_todos2_est
cb_borrar1_est cb_borrar1_est
cb_todos1_est cb_todos1_est
dw_destino_seleccion dw_destino_seleccion
dw_destino dw_destino
dw_tipoobra dw_tipoobra
dw_tipoact dw_tipoact
dw_tipo_obra_seleccion dw_tipo_obra_seleccion
dw_tipo_actuacion_seleccion dw_tipo_actuacion_seleccion
gb_1 gb_1
gb_9 gb_9
gb_11 gb_11
end type

on tabpage_9.create
this.cb_borrar3_est=create cb_borrar3_est
this.cb_todos3_est=create cb_todos3_est
this.cb_borrar2_est=create cb_borrar2_est
this.cb_todos2_est=create cb_todos2_est
this.cb_borrar1_est=create cb_borrar1_est
this.cb_todos1_est=create cb_todos1_est
this.dw_destino_seleccion=create dw_destino_seleccion
this.dw_destino=create dw_destino
this.dw_tipoobra=create dw_tipoobra
this.dw_tipoact=create dw_tipoact
this.dw_tipo_obra_seleccion=create dw_tipo_obra_seleccion
this.dw_tipo_actuacion_seleccion=create dw_tipo_actuacion_seleccion
this.gb_1=create gb_1
this.gb_9=create gb_9
this.gb_11=create gb_11
this.Control[]={this.cb_borrar3_est,&
this.cb_todos3_est,&
this.cb_borrar2_est,&
this.cb_todos2_est,&
this.cb_borrar1_est,&
this.cb_todos1_est,&
this.dw_destino_seleccion,&
this.dw_destino,&
this.dw_tipoobra,&
this.dw_tipoact,&
this.dw_tipo_obra_seleccion,&
this.dw_tipo_actuacion_seleccion,&
this.gb_1,&
this.gb_9,&
this.gb_11}
end on

on tabpage_9.destroy
destroy(this.cb_borrar3_est)
destroy(this.cb_todos3_est)
destroy(this.cb_borrar2_est)
destroy(this.cb_todos2_est)
destroy(this.cb_borrar1_est)
destroy(this.cb_todos1_est)
destroy(this.dw_destino_seleccion)
destroy(this.dw_destino)
destroy(this.dw_tipoobra)
destroy(this.dw_tipoact)
destroy(this.dw_tipo_obra_seleccion)
destroy(this.dw_tipo_actuacion_seleccion)
destroy(this.gb_1)
destroy(this.gb_9)
destroy(this.gb_11)
end on

type cb_borrar3_est from commandbutton within tabpage_9
boolean visible = false
integer x = 2098
integer y = 1548
integer width = 329
integer height = 68
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_destino.rowcount() 
	idw_destino.SetItem(i,'activo','N')
next
end event

type cb_todos3_est from commandbutton within tabpage_9
boolean visible = false
integer x = 1765
integer y = 1548
integer width = 329
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_destino.rowcount() 
	idw_destino.SetItem(i,'activo','S')
next
end event

type cb_borrar2_est from commandbutton within tabpage_9
boolean visible = false
integer x = 1239
integer y = 1548
integer width = 329
integer height = 68
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_tipoobra.rowcount() 
	idw_tipoobra.SetItem(i,'activo','N')
next
end event

type cb_todos2_est from commandbutton within tabpage_9
boolean visible = false
integer x = 901
integer y = 1548
integer width = 329
integer height = 68
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_tipoobra.rowcount() 
	idw_tipoobra.SetItem(i,'activo','S')
next
end event

type cb_borrar1_est from commandbutton within tabpage_9
boolean visible = false
integer x = 370
integer y = 1548
integer width = 329
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_tipoact.rowcount() 
	idw_tipoact.SetItem(i,'activo','N')
next
end event

type cb_todos1_est from commandbutton within tabpage_9
boolean visible = false
integer x = 32
integer y = 1548
integer width = 329
integer height = 68
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_tipoact.rowcount() 
	idw_tipoact.SetItem(i,'activo','S')
next
end event

type dw_destino_seleccion from u_dw within tabpage_9
integer x = 1842
integer y = 80
integer width = 736
integer height = 112
integer taborder = 11
string dataobject = "d_fases_consulta_seleccion"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos3_est.visible=true
	cb_borrar3_est.visible=true
	idw_destino.visible = true
else
	cb_todos3_est.visible=false
	cb_borrar3_est.visible=false
	idw_destino.visible=false
end if 
end event

type dw_destino from u_dw within tabpage_9
boolean visible = false
integer x = 1787
integer y = 224
integer width = 823
integer height = 1304
integer taborder = 11
string dataobject = "d_fases_consulta_destino"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
end type

type dw_tipoobra from u_dw within tabpage_9
boolean visible = false
integer x = 928
integer y = 224
integer width = 814
integer height = 1304
integer taborder = 11
string dataobject = "d_fases_consulta_tipoobra"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
end type

type dw_tipoact from u_dw within tabpage_9
boolean visible = false
integer x = 37
integer y = 224
integer width = 837
integer height = 1304
integer taborder = 11
string dataobject = "d_fases_consulta_tipoact"
boolean border = false
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
end type

type dw_tipo_obra_seleccion from u_dw within tabpage_9
integer x = 951
integer y = 80
integer width = 736
integer height = 112
integer taborder = 11
string dataobject = "d_fases_consulta_seleccion"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos2_est.visible=true
	cb_borrar2_est.visible=true
	idw_tipoobra.visible = true
else
	cb_todos2_est.visible=false
	cb_borrar2_est.visible=false
	idw_tipoobra.visible=false
end if 
end event

type dw_tipo_actuacion_seleccion from u_dw within tabpage_9
integer x = 78
integer y = 80
integer width = 736
integer height = 112
integer taborder = 11
string dataobject = "d_fases_consulta_seleccion"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos1_est.visible=true
	cb_borrar1_est.visible=true
	idw_tipoact.visible = true
else
	cb_todos1_est.visible=false
	cb_borrar1_est.visible=false
	idw_tipoact.visible=false
end if 
end event

type gb_1 from groupbox within tabpage_9
integer x = 23
integer y = 16
integer width = 859
integer height = 1528
integer taborder = 41
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Tipo Actuaci$$HEX1$$f300$$ENDHEX$$n"
end type

type gb_9 from groupbox within tabpage_9
integer x = 896
integer y = 16
integer width = 859
integer height = 1528
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Tipo Obra"
end type

type gb_11 from groupbox within tabpage_9
integer x = 1765
integer y = 16
integer width = 859
integer height = 1528
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Destino"
end type

type tabpage_2 from userobject within tab_1
string tag = "texto=fases.contrato_control"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Contrato Control"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
cb_todos7 cb_todos7
cb_todos4 cb_todos4
gb_12 gb_12
gb_estados gb_estados
gb_gestion gb_gestion
gb_modalidad gb_modalidad
dw_modalidad_contrato dw_modalidad_contrato
dw_gestion_contrato dw_gestion_contrato
dw_estados_contrato dw_estados_contrato
dw_seleccion_estados dw_seleccion_estados
cb_todos1 cb_todos1
cb_borrar1 cb_borrar1
dw_seleccion_gestion dw_seleccion_gestion
dw_seleccion_modalidad dw_seleccion_modalidad
cb_todos2 cb_todos2
cb_borrar2 cb_borrar2
cb_todos3 cb_todos3
cb_borrar3 cb_borrar3
dw_consulta_col_destino dw_consulta_col_destino
dw_seleccion_col_destino dw_seleccion_col_destino
end type

on tabpage_2.create
this.cb_todos7=create cb_todos7
this.cb_todos4=create cb_todos4
this.gb_12=create gb_12
this.gb_estados=create gb_estados
this.gb_gestion=create gb_gestion
this.gb_modalidad=create gb_modalidad
this.dw_modalidad_contrato=create dw_modalidad_contrato
this.dw_gestion_contrato=create dw_gestion_contrato
this.dw_estados_contrato=create dw_estados_contrato
this.dw_seleccion_estados=create dw_seleccion_estados
this.cb_todos1=create cb_todos1
this.cb_borrar1=create cb_borrar1
this.dw_seleccion_gestion=create dw_seleccion_gestion
this.dw_seleccion_modalidad=create dw_seleccion_modalidad
this.cb_todos2=create cb_todos2
this.cb_borrar2=create cb_borrar2
this.cb_todos3=create cb_todos3
this.cb_borrar3=create cb_borrar3
this.dw_consulta_col_destino=create dw_consulta_col_destino
this.dw_seleccion_col_destino=create dw_seleccion_col_destino
this.Control[]={this.cb_todos7,&
this.cb_todos4,&
this.gb_12,&
this.gb_estados,&
this.gb_gestion,&
this.gb_modalidad,&
this.dw_modalidad_contrato,&
this.dw_gestion_contrato,&
this.dw_estados_contrato,&
this.dw_seleccion_estados,&
this.cb_todos1,&
this.cb_borrar1,&
this.dw_seleccion_gestion,&
this.dw_seleccion_modalidad,&
this.cb_todos2,&
this.cb_borrar2,&
this.cb_todos3,&
this.cb_borrar3,&
this.dw_consulta_col_destino,&
this.dw_seleccion_col_destino}
end on

on tabpage_2.destroy
destroy(this.cb_todos7)
destroy(this.cb_todos4)
destroy(this.gb_12)
destroy(this.gb_estados)
destroy(this.gb_gestion)
destroy(this.gb_modalidad)
destroy(this.dw_modalidad_contrato)
destroy(this.dw_gestion_contrato)
destroy(this.dw_estados_contrato)
destroy(this.dw_seleccion_estados)
destroy(this.cb_todos1)
destroy(this.cb_borrar1)
destroy(this.dw_seleccion_gestion)
destroy(this.dw_seleccion_modalidad)
destroy(this.cb_todos2)
destroy(this.cb_borrar2)
destroy(this.cb_todos3)
destroy(this.cb_borrar3)
destroy(this.dw_consulta_col_destino)
destroy(this.dw_seleccion_col_destino)
end on

type cb_todos7 from commandbutton within tabpage_2
boolean visible = false
integer x = 2089
integer y = 1596
integer width = 325
integer height = 68
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_colegio_dest.rowcount() 
	idw_colegio_dest.SetItem(i,'activo','N')
next
end event

type cb_todos4 from commandbutton within tabpage_2
boolean visible = false
integer x = 1760
integer y = 1596
integer width = 325
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_colegio_dest.rowcount() 
	idw_colegio_dest.SetItem(i,'activo','S')
next
end event

type gb_12 from groupbox within tabpage_2
integer x = 1755
integer y = 16
integer width = 878
integer height = 1568
integer taborder = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Colegio Destino"
end type

type gb_estados from groupbox within tabpage_2
integer x = 5
integer y = 16
integer width = 878
integer height = 1568
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Estados"
end type

type gb_gestion from groupbox within tabpage_2
integer x = 901
integer y = 16
integer width = 841
integer height = 704
integer taborder = 20
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Tipo Gesti$$HEX1$$f300$$ENDHEX$$n"
end type

type gb_modalidad from groupbox within tabpage_2
integer x = 901
integer y = 844
integer width = 841
integer height = 736
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Modalidad"
end type

type dw_modalidad_contrato from u_dw within tabpage_2
boolean visible = false
integer x = 914
integer y = 1040
integer width = 795
integer height = 480
integer taborder = 60
boolean bringtotop = true
string dataobject = "d_fases_consulta_modalidad"
boolean border = false
boolean ib_isupdateable = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_opcion_bajas.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_bajas.SetItem(1,'opcion','S')
end event

type dw_gestion_contrato from u_dw within tabpage_2
boolean visible = false
integer x = 914
integer y = 212
integer width = 795
integer height = 468
integer taborder = 50
boolean bringtotop = true
string dataobject = "d_fases_consulta_gestion"
boolean border = false
boolean ib_isupdateable = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_opcion_bajas.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_bajas.SetItem(1,'opcion','S')
end event

type dw_estados_contrato from u_dw within tabpage_2
event csd_consulta_estados ( )
boolean visible = false
integer x = 41
integer y = 212
integer width = 832
integer height = 1236
integer taborder = 40
boolean bringtotop = true
string dataobject = "d_fases_consulta_estados"
boolean border = false
boolean ib_isupdateable = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_opcion_bajas.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_bajas.SetItem(1,'opcion','S')
end event

type dw_seleccion_estados from u_dw within tabpage_2
integer x = 78
integer y = 76
integer width = 736
integer height = 112
integer taborder = 31
boolean bringtotop = true
string dataobject = "d_fases_consulta_seleccion"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos1.visible=true
	cb_borrar1.visible=true
	idw_estados_contrato.visible = true
else
	cb_todos1.visible=false
	cb_borrar1.visible=false
	idw_estados_contrato.visible=false
end if 
end event

type cb_todos1 from commandbutton within tabpage_2
boolean visible = false
integer x = 18
integer y = 1596
integer width = 329
integer height = 68
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_estados_contrato.rowcount() 
	idw_estados_contrato.SetItem(i,'activo','S')
next
end event

type cb_borrar1 from commandbutton within tabpage_2
boolean visible = false
integer x = 347
integer y = 1596
integer width = 325
integer height = 68
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_estados_contrato.rowcount() 
	idw_estados_contrato.SetItem(i,'activo','N')
next
end event

type dw_seleccion_gestion from u_dw within tabpage_2
integer x = 951
integer y = 80
integer width = 736
integer height = 112
integer taborder = 41
boolean bringtotop = true
string dataobject = "d_fases_consulta_seleccion"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos2.visible=true
	cb_borrar2.visible=true
	idw_gestion_contrato.visible = true
else
	cb_todos2.visible=false
	cb_borrar2.visible=false
	idw_gestion_contrato.visible=false
end if 
end event

type dw_seleccion_modalidad from u_dw within tabpage_2
integer x = 955
integer y = 912
integer width = 736
integer height = 112
integer taborder = 51
boolean bringtotop = true
string dataobject = "d_fases_consulta_seleccion"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos3.visible=true
	cb_borrar3.visible=true
	idw_modalidad_contrato.visible = true
else
	cb_todos3.visible=false
	cb_borrar3.visible=false
	idw_modalidad_contrato.visible=false
end if 
end event

type cb_todos2 from commandbutton within tabpage_2
boolean visible = false
integer x = 914
integer y = 732
integer width = 325
integer height = 68
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_gestion_contrato.rowcount() 
	idw_gestion_contrato.SetItem(i,'activo','S')
next
end event

type cb_borrar2 from commandbutton within tabpage_2
boolean visible = false
integer x = 1243
integer y = 732
integer width = 325
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_gestion_contrato.rowcount() 
	idw_gestion_contrato.SetItem(i,'activo','N')
next
end event

type cb_todos3 from commandbutton within tabpage_2
boolean visible = false
integer x = 919
integer y = 1596
integer width = 325
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_gestion_contrato.rowcount() 
	idw_modalidad_contrato.SetItem(i,'activo','S')
next
end event

type cb_borrar3 from commandbutton within tabpage_2
boolean visible = false
integer x = 1248
integer y = 1596
integer width = 325
integer height = 68
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_modalidad_contrato.rowcount() 
	idw_modalidad_contrato.SetItem(i,'activo','N')
next
end event

type dw_consulta_col_destino from u_dw within tabpage_2
boolean visible = false
integer x = 1783
integer y = 272
integer width = 846
integer height = 1280
integer taborder = 11
boolean bringtotop = true
string dataobject = "d_fases_consulta_col_destino"
boolean border = false
borderstyle borderstyle = stylebox!
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_seleccion_col_dest.GetItemString(1,'opcion')
if opcion='%' then idw_seleccion_col_dest.SetItem(1,'opcion','S')
end event

type dw_seleccion_col_destino from u_dw within tabpage_2
integer x = 1833
integer y = 80
integer width = 768
integer height = 96
integer taborder = 21
boolean bringtotop = true
string dataobject = "d_fases_consulta_seleccion"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos4.visible=true
	cb_todos7.visible=true
	idw_colegio_dest.visible = true
else
	cb_todos4.visible=false
	cb_todos7.visible=false
	idw_colegio_dest.visible=false
end if 
end event

type tabpage_7 from userobject within tab_1
string tag = "texto=fases.otros_documentos"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Otros Documentos"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_otros_doc_contrato dw_otros_doc_contrato
dw_otros_docs dw_otros_docs
end type

on tabpage_7.create
this.dw_otros_doc_contrato=create dw_otros_doc_contrato
this.dw_otros_docs=create dw_otros_docs
this.Control[]={this.dw_otros_doc_contrato,&
this.dw_otros_docs}
end on

on tabpage_7.destroy
destroy(this.dw_otros_doc_contrato)
destroy(this.dw_otros_docs)
end on

type dw_otros_doc_contrato from u_dw within tabpage_7
boolean visible = false
integer x = 1559
integer y = 264
integer width = 823
integer height = 1184
integer taborder = 60
boolean bringtotop = true
string dataobject = "d_fases_consulta_otros_docs_tipos"
boolean border = false
boolean ib_isupdateable = false
end type

event itemchanged;string opcion

opcion = idw_otros_doc_contrato.GetItemString(1,'activo')
if opcion='%' then idw_otros_doc_contrato.SetItem(1,'activo','S')
end event

type dw_otros_docs from u_dw within tabpage_7
integer x = 41
integer y = 16
integer width = 2574
integer height = 1640
integer taborder = 20
string dataobject = "d_fases_consulta_otros_docs"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event buttonclicked;call super::buttonclicked;int i
choose case dwo.name
	case 'b_1'
		for i=1 to idw_otros_doc_contrato.rowcount() 
			idw_otros_doc_contrato.SetItem(i,'activo','S')
		next
	case 'b_2'
		for i=1 to idw_otros_doc_contrato.rowcount() 
			idw_otros_doc_contrato.SetItem(i,'activo','N')
		next		
end choose
end event

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

event itemchanged;call super::itemchanged;choose case dwo.name
	case 'tipo'
	if data ='S' then
		idw_otros_doc_contrato.visible = true
	else
		idw_otros_doc_contrato.visible=false
	end if 
	
end choose
end event

type tabpage_6 from userobject within tab_1
string tag = "texto=fases.otros_datos"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Otros Datos"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_pagos_plataforma dw_pagos_plataforma
dw_renuncias dw_renuncias
dw_registro_es dw_registro_es
dw_reparos dw_reparos
dw_reclamaciones dw_reclamaciones
dw_garantias dw_garantias
dw_final_obra dw_final_obra
end type

on tabpage_6.create
this.dw_pagos_plataforma=create dw_pagos_plataforma
this.dw_renuncias=create dw_renuncias
this.dw_registro_es=create dw_registro_es
this.dw_reparos=create dw_reparos
this.dw_reclamaciones=create dw_reclamaciones
this.dw_garantias=create dw_garantias
this.dw_final_obra=create dw_final_obra
this.Control[]={this.dw_pagos_plataforma,&
this.dw_renuncias,&
this.dw_registro_es,&
this.dw_reparos,&
this.dw_reclamaciones,&
this.dw_garantias,&
this.dw_final_obra}
end on

on tabpage_6.destroy
destroy(this.dw_pagos_plataforma)
destroy(this.dw_renuncias)
destroy(this.dw_registro_es)
destroy(this.dw_reparos)
destroy(this.dw_reclamaciones)
destroy(this.dw_garantias)
destroy(this.dw_final_obra)
end on

type dw_pagos_plataforma from u_dw within tabpage_6
boolean visible = false
integer x = 46
integer y = 1584
integer width = 2574
integer height = 412
integer taborder = 60
boolean bringtotop = true
string dataobject = "d_fases_consulta_pagos"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)


end event

type dw_renuncias from u_csd_dw within tabpage_6
integer x = 46
integer y = 1348
integer width = 2560
integer height = 268
integer taborder = 11
string dataobject = "d_fases_consulta_renuncias"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type dw_registro_es from u_dw within tabpage_6
integer x = 46
integer y = 1136
integer width = 2574
integer height = 256
integer taborder = 50
string dataobject = "d_fases_consulta_registro_es"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type dw_reparos from u_dw within tabpage_6
integer x = 41
integer y = 856
integer width = 2574
integer height = 324
integer taborder = 30
string dataobject = "d_fases_consulta_reparos"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type dw_reclamaciones from u_dw within tabpage_6
integer x = 41
integer y = 652
integer width = 2574
integer height = 292
integer taborder = 40
string dataobject = "d_fases_consulta_reclamaciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type dw_garantias from u_dw within tabpage_6
integer x = 41
integer y = 372
integer width = 2574
integer height = 332
integer taborder = 20
string dataobject = "d_fases_consulta_garantias"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type dw_final_obra from u_dw within tabpage_6
integer x = 41
integer width = 2574
integer height = 368
integer taborder = 10
string dataobject = "d_fases_consulta_finales_obra"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type tabpage_8 from userobject within tab_1
string tag = "texto=menu.arquitectos"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Arquitectos"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_arquitectos dw_arquitectos
end type

on tabpage_8.create
this.dw_arquitectos=create dw_arquitectos
this.Control[]={this.dw_arquitectos}
end on

on tabpage_8.destroy
destroy(this.dw_arquitectos)
end on

type dw_arquitectos from u_dw within tabpage_8
integer x = 41
integer y = 40
integer width = 2574
integer height = 368
integer taborder = 20
boolean bringtotop = true
string dataobject = "d_fases_consulta_arquitectos"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type tabpage_3 from userobject within tab_1
event create ( )
event destroy ( )
string tag = "texto=fases.col_sit_pro"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Colegiados Sit. Profesional"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_datos_agrupacion dw_datos_agrupacion
dw_opcion_agr dw_opcion_agr
dw_opcion_sit dw_opcion_sit
dw_opcion_incomp dw_opcion_incomp
dw_agrupaciones dw_agrupaciones
dw_sit_profesionales dw_sit_profesionales
dw_incompatibilidades dw_incompatibilidades
cb_incluir4 cb_incluir4
cb_borrar4 cb_borrar4
cb_3 cb_3
cb_4 cb_4
cb_5 cb_5
cb_6 cb_6
dw_datos_sitprof dw_datos_sitprof
gb_7 gb_7
gb_6 gb_6
gb_5 gb_5
gb_4 gb_4
gb_8 gb_8
end type

on tabpage_3.create
this.dw_datos_agrupacion=create dw_datos_agrupacion
this.dw_opcion_agr=create dw_opcion_agr
this.dw_opcion_sit=create dw_opcion_sit
this.dw_opcion_incomp=create dw_opcion_incomp
this.dw_agrupaciones=create dw_agrupaciones
this.dw_sit_profesionales=create dw_sit_profesionales
this.dw_incompatibilidades=create dw_incompatibilidades
this.cb_incluir4=create cb_incluir4
this.cb_borrar4=create cb_borrar4
this.cb_3=create cb_3
this.cb_4=create cb_4
this.cb_5=create cb_5
this.cb_6=create cb_6
this.dw_datos_sitprof=create dw_datos_sitprof
this.gb_7=create gb_7
this.gb_6=create gb_6
this.gb_5=create gb_5
this.gb_4=create gb_4
this.gb_8=create gb_8
this.Control[]={this.dw_datos_agrupacion,&
this.dw_opcion_agr,&
this.dw_opcion_sit,&
this.dw_opcion_incomp,&
this.dw_agrupaciones,&
this.dw_sit_profesionales,&
this.dw_incompatibilidades,&
this.cb_incluir4,&
this.cb_borrar4,&
this.cb_3,&
this.cb_4,&
this.cb_5,&
this.cb_6,&
this.dw_datos_sitprof,&
this.gb_7,&
this.gb_6,&
this.gb_5,&
this.gb_4,&
this.gb_8}
end on

on tabpage_3.destroy
destroy(this.dw_datos_agrupacion)
destroy(this.dw_opcion_agr)
destroy(this.dw_opcion_sit)
destroy(this.dw_opcion_incomp)
destroy(this.dw_agrupaciones)
destroy(this.dw_sit_profesionales)
destroy(this.dw_incompatibilidades)
destroy(this.cb_incluir4)
destroy(this.cb_borrar4)
destroy(this.cb_3)
destroy(this.cb_4)
destroy(this.cb_5)
destroy(this.cb_6)
destroy(this.dw_datos_sitprof)
destroy(this.gb_7)
destroy(this.gb_6)
destroy(this.gb_5)
destroy(this.gb_4)
destroy(this.gb_8)
end on

type dw_datos_agrupacion from u_dw within tabpage_3
integer x = 69
integer y = 72
integer width = 1061
integer height = 332
integer taborder = 31
string dataobject = "d_colegiados_consulta_datos_agrupacion"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event constructor;call super::constructor;
// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type dw_opcion_agr from u_dw within tabpage_3
integer x = 105
integer y = 520
integer width = 727
integer height = 128
integer taborder = 31
string dataobject = "d_colegiados_consulta_opciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_incluir4.visible=true
	cb_borrar4.visible=true
	dw_agrupaciones.visible = true
else
	cb_incluir4.visible=false
	cb_borrar4.visible=false
	dw_agrupaciones.visible=false
end if 
end event

type dw_opcion_sit from u_dw within tabpage_3
integer x = 951
integer y = 520
integer width = 727
integer height = 112
integer taborder = 31
string dataobject = "d_colegiados_consulta_opciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_3.visible=true
	cb_4.visible=true
	dw_sit_profesionales.visible = true
else
	cb_3.visible=false
	cb_4.visible=false
	dw_sit_profesionales.visible=false
end if 
end event

type dw_opcion_incomp from u_dw within tabpage_3
integer x = 1806
integer y = 520
integer width = 727
integer height = 112
integer taborder = 31
string dataobject = "d_colegiados_consulta_opciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_5.visible=true
	cb_6.visible=true
	dw_incompatibilidades.visible = true
else
	cb_5.visible=false
	cb_6.visible=false
	dw_incompatibilidades.visible=false
end if 
end event

type dw_agrupaciones from u_dw within tabpage_3
boolean visible = false
integer x = 87
integer y = 656
integer width = 773
integer height = 848
integer taborder = 40
string dataobject = "d_colegiados_consulta_agrupaciones"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;string opcion

opcion = idw_opcion_agr.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_agr.SetItem(1,'opcion','S')
end event

type dw_sit_profesionales from u_dw within tabpage_3
boolean visible = false
integer x = 928
integer y = 656
integer width = 763
integer height = 848
integer taborder = 31
string dataobject = "d_colegiados_consulta_sit_profesional"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;string opcion

opcion = idw_opcion_sit.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_sit.SetItem(1,'opcion','S')
end event

type dw_incompatibilidades from u_dw within tabpage_3
boolean visible = false
integer x = 1792
integer y = 656
integer width = 763
integer height = 848
integer taborder = 31
string dataobject = "d_colegiados_consulta_incompatibilidades"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_opcion_incomp.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_incomp.SetItem(1,'opcion','S')
end event

type cb_incluir4 from commandbutton within tabpage_3
boolean visible = false
integer x = 46
integer y = 1524
integer width = 325
integer height = 68
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel.Todos"
end type

event clicked;int i

for i=1 to idw_agrupaciones.rowcount() 
	idw_agrupaciones.SetItem(i,'activo','S')
next
end event

type cb_borrar4 from commandbutton within tabpage_3
boolean visible = false
integer x = 375
integer y = 1524
integer width = 325
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "BorrarTodos"
end type

event clicked;int i

for i=1 to idw_agrupaciones.rowcount() 
	idw_agrupaciones.SetItem(i,'activo','N')
next
end event

type cb_3 from commandbutton within tabpage_3
boolean visible = false
integer x = 910
integer y = 1520
integer width = 325
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel.Todos"
end type

event clicked;int i

for i=1 to idw_sit_profesionales.rowcount() 
	idw_sit_profesionales.SetItem(i,'activo','S')
next
end event

type cb_4 from commandbutton within tabpage_3
boolean visible = false
integer x = 1239
integer y = 1520
integer width = 325
integer height = 68
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "BorrarTodos"
end type

event clicked;int i

for i=1 to idw_sit_profesionales.rowcount() 
	idw_sit_profesionales.SetItem(i,'activo','N')
next
end event

type cb_5 from commandbutton within tabpage_3
boolean visible = false
integer x = 1778
integer y = 1520
integer width = 325
integer height = 68
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel.Todos"
end type

event clicked;int i

for i=1 to idw_incompatibilidades.rowcount() 
	idw_incompatibilidades.SetItem(i,'activo','S')
next
end event

type cb_6 from commandbutton within tabpage_3
boolean visible = false
integer x = 2107
integer y = 1520
integer width = 325
integer height = 68
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "BorrarTodos"
end type

event clicked;int i

for i=1 to idw_incompatibilidades.rowcount() 
	idw_incompatibilidades.SetItem(i,'activo','N')
next
end event

type dw_datos_sitprof from u_dw within tabpage_3
integer x = 1275
integer y = 68
integer width = 1257
integer height = 360
integer taborder = 50
boolean bringtotop = true
string dataobject = "d_colegiados_consulta_datos_sitprof"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
end type

event buttonclicked;call super::buttonclicked;string pob, ls_anterior 

g_busqueda.titulo='Poblaciones'
g_busqueda.dw='d_poblaciones_lista_busqueda'
ls_anterior = g_bloqueo_fases
g_bloqueo_fases = 'S'
pob=f_busqueda_poblaciones()
g_bloqueo_fases = ls_anterior
if f_es_vacio(pob) then return
this.SetItem(1,'poblacion',pob)

end event

event constructor;call super::constructor;
// Activamos el control calendario para los campos de tipo fecha
this.of_SetDropDownCalendar(True)
this.iuo_calendar.of_register(this.iuo_calendar.DDLB)
this.iuo_calendar.of_SetDateFormat("dd/mm/yyyy")
this.iuo_calendar.of_SetInitialValue(True)
end event

type gb_7 from groupbox within tabpage_3
integer x = 50
integer y = 12
integer width = 1125
integer height = 432
integer taborder = 90
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Datos Agrupaci$$HEX1$$f300$$ENDHEX$$n"
end type

type gb_6 from groupbox within tabpage_3
integer x = 1783
integer y = 460
integer width = 791
integer height = 1052
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Incompatibilidades"
end type

type gb_5 from groupbox within tabpage_3
integer x = 910
integer y = 460
integer width = 800
integer height = 1052
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Situaciones Profesionales"
end type

type gb_4 from groupbox within tabpage_3
integer x = 46
integer y = 460
integer width = 827
integer height = 1052
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Agrupaciones"
end type

type gb_8 from groupbox within tabpage_3
integer x = 1202
integer y = 12
integer width = 1367
integer height = 432
integer taborder = 100
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Datos Situaciones,Incompatibilidades"
end type

type tabpage_4 from userobject within tab_1
event create ( )
event destroy ( )
string tag = "texto=fases.col_sit_col"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Colegiados Sit. Colegial"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_opcion_situaciones dw_opcion_situaciones
dw_alta_si_no dw_alta_si_no
dw_situaciones dw_situaciones
dw_t_alta dw_t_alta
dw_opcion_bajas dw_opcion_bajas
cb_todos10 cb_todos10
cb_borrar10 cb_borrar10
cb_todos20 cb_todos20
cb_borrar20 cb_borrar20
cb_todos30 cb_todos30
cb_borrar30 cb_borrar30
dw_opcion_altas dw_opcion_altas
dw_t_baja dw_t_baja
gb_2 gb_2
gb_10 gb_10
gb_3 gb_3
end type

on tabpage_4.create
this.dw_opcion_situaciones=create dw_opcion_situaciones
this.dw_alta_si_no=create dw_alta_si_no
this.dw_situaciones=create dw_situaciones
this.dw_t_alta=create dw_t_alta
this.dw_opcion_bajas=create dw_opcion_bajas
this.cb_todos10=create cb_todos10
this.cb_borrar10=create cb_borrar10
this.cb_todos20=create cb_todos20
this.cb_borrar20=create cb_borrar20
this.cb_todos30=create cb_todos30
this.cb_borrar30=create cb_borrar30
this.dw_opcion_altas=create dw_opcion_altas
this.dw_t_baja=create dw_t_baja
this.gb_2=create gb_2
this.gb_10=create gb_10
this.gb_3=create gb_3
this.Control[]={this.dw_opcion_situaciones,&
this.dw_alta_si_no,&
this.dw_situaciones,&
this.dw_t_alta,&
this.dw_opcion_bajas,&
this.cb_todos10,&
this.cb_borrar10,&
this.cb_todos20,&
this.cb_borrar20,&
this.cb_todos30,&
this.cb_borrar30,&
this.dw_opcion_altas,&
this.dw_t_baja,&
this.gb_2,&
this.gb_10,&
this.gb_3}
end on

on tabpage_4.destroy
destroy(this.dw_opcion_situaciones)
destroy(this.dw_alta_si_no)
destroy(this.dw_situaciones)
destroy(this.dw_t_alta)
destroy(this.dw_opcion_bajas)
destroy(this.cb_todos10)
destroy(this.cb_borrar10)
destroy(this.cb_todos20)
destroy(this.cb_borrar20)
destroy(this.cb_todos30)
destroy(this.cb_borrar30)
destroy(this.dw_opcion_altas)
destroy(this.dw_t_baja)
destroy(this.gb_2)
destroy(this.gb_10)
destroy(this.gb_3)
end on

type dw_opcion_situaciones from u_dw within tabpage_4
integer x = 78
integer y = 128
integer width = 736
integer height = 112
integer taborder = 31
string dataobject = "d_colegiados_consulta_opciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos10.visible=true
	cb_borrar10.visible=true
	dw_situaciones.visible = true
else
	cb_todos10.visible=false
	cb_borrar10.visible=false
	dw_situaciones.visible=false
end if 
end event

type dw_alta_si_no from u_dw within tabpage_4
integer x = 878
integer y = 68
integer width = 955
integer height = 136
integer taborder = 60
string dataobject = "d_colegiados_consulta_alta"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;boolean alta,baja

choose case data 
	case 'S' 
		alta = true
		baja = false
		cb_todos20.TriggerEvent(Clicked!)
	case 'N'
		alta = false
		baja = true
		cb_todos30.TriggerEvent(Clicked!)
	case else
		alta = false
		baja = false
end choose
gb_3.visible= baja
cb_todos30.visible= baja
cb_borrar30.visible = baja
idw_t_baja.visible = baja
gb_2.visible=alta
cb_todos20.visible=alta
cb_borrar20.visible = alta
idw_t_alta.visible = alta
		
end event

type dw_situaciones from u_dw within tabpage_4
boolean visible = false
integer x = 41
integer y = 280
integer width = 800
integer height = 1256
integer taborder = 41
string dataobject = "d_colegiados_situaciones_consulta"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_opcion_sit.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_sit.SetItem(1,'opcion','S')
end event

type dw_t_alta from u_dw within tabpage_4
boolean visible = false
integer x = 901
integer y = 268
integer width = 800
integer height = 1252
integer taborder = 31
boolean bringtotop = true
string dataobject = "d_colegiados_t_alta_consulta"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_opcion_altas.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_altas.SetItem(1,'opcion','S')
end event

type dw_opcion_bajas from u_dw within tabpage_4
boolean visible = false
integer x = 1797
integer y = 280
integer width = 736
integer height = 112
integer taborder = 41
string dataobject = "d_colegiados_consulta_opciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos30.visible=true
	cb_borrar30.visible=true
	dw_t_baja.visible = true
else
	cb_todos30.visible=false
	cb_borrar30.visible=false
	dw_t_baja.visible=false
end if 
end event

type cb_todos10 from commandbutton within tabpage_4
boolean visible = false
integer x = 14
integer y = 1576
integer width = 325
integer height = 68
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_situaciones.rowcount() 
	idw_situaciones.SetItem(i,'activo','S')
next
end event

type cb_borrar10 from commandbutton within tabpage_4
boolean visible = false
integer x = 343
integer y = 1576
integer width = 325
integer height = 68
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_situaciones.rowcount() 
	idw_situaciones.SetItem(i,'activo','N')
next
end event

type cb_todos20 from commandbutton within tabpage_4
boolean visible = false
integer x = 864
integer y = 1572
integer width = 325
integer height = 68
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_situaciones.rowcount() 
	idw_t_alta.SetItem(i,'activo','S')
next
end event

type cb_borrar20 from commandbutton within tabpage_4
boolean visible = false
integer x = 1193
integer y = 1572
integer width = 325
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_situaciones.rowcount() 
	idw_t_alta.SetItem(i,'activo','N')
next
end event

type cb_todos30 from commandbutton within tabpage_4
boolean visible = false
integer x = 1751
integer y = 1568
integer width = 325
integer height = 68
integer taborder = 70
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_t_baja.rowcount() 
	idw_t_baja.SetItem(i,'activo','S')
next
end event

type cb_borrar30 from commandbutton within tabpage_4
boolean visible = false
integer x = 2080
integer y = 1568
integer width = 325
integer height = 68
integer taborder = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_t_baja.rowcount() 
	idw_t_baja.SetItem(i,'activo','N')
next
end event

type dw_opcion_altas from u_dw within tabpage_4
boolean visible = false
integer x = 978
integer y = 280
integer width = 736
integer height = 112
integer taborder = 60
string dataobject = "d_colegiados_consulta_opciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos20.visible=true
	cb_borrar20.visible=true
	dw_t_alta.visible = true
else
	cb_todos20.visible=false
	cb_borrar20.visible=false
	dw_t_alta.visible=false
end if 
end event

type dw_t_baja from u_dw within tabpage_4
boolean visible = false
integer x = 1760
integer y = 268
integer width = 823
integer height = 1252
integer taborder = 50
boolean bringtotop = true
string dataobject = "d_colegiados_t_baja_consulta"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_opcion_bajas.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_bajas.SetItem(1,'opcion','S')
end event

type gb_2 from groupbox within tabpage_4
integer x = 864
integer y = 200
integer width = 864
integer height = 1356
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 79741120
string text = "Altas"
end type

type gb_10 from groupbox within tabpage_4
integer x = 9
integer y = 48
integer width = 846
integer height = 1508
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Situaciones"
end type

type gb_3 from groupbox within tabpage_4
integer x = 1746
integer y = 200
integer width = 850
integer height = 1356
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Bajas"
end type

type tabpage_10 from userobject within tab_1
event create ( )
event destroy ( )
string tag = "texto=fases.col_sit_residente"
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Colegiados Sit. Residente"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_opcion_residente dw_opcion_residente
dw_residente dw_residente
cb_borrar5 cb_borrar5
cb_todos5 cb_todos5
gb_15 gb_15
end type

on tabpage_10.create
this.dw_opcion_residente=create dw_opcion_residente
this.dw_residente=create dw_residente
this.cb_borrar5=create cb_borrar5
this.cb_todos5=create cb_todos5
this.gb_15=create gb_15
this.Control[]={this.dw_opcion_residente,&
this.dw_residente,&
this.cb_borrar5,&
this.cb_todos5,&
this.gb_15}
end on

on tabpage_10.destroy
destroy(this.dw_opcion_residente)
destroy(this.dw_residente)
destroy(this.cb_borrar5)
destroy(this.cb_todos5)
destroy(this.gb_15)
end on

type dw_opcion_residente from u_dw within tabpage_10
integer x = 78
integer y = 128
integer width = 736
integer height = 112
integer taborder = 10
string dataobject = "d_colegiados_consulta_opciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos5.visible=true
	cb_borrar5.visible=true
	dw_residente.visible = true
else
	cb_todos5.visible=false
	cb_borrar5.visible=false
	dw_residente.visible=false
end if 
end event

type dw_residente from u_dw within tabpage_10
boolean visible = false
integer x = 41
integer y = 280
integer width = 800
integer height = 1256
integer taborder = 10
string dataobject = "d_colegiados_consulta_residente"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = idw_opcion_residente.GetItemString(1,'opcion')
if opcion='%' then idw_opcion_residente.SetItem(1,'opcion','S')
end event

type cb_borrar5 from commandbutton within tabpage_10
boolean visible = false
integer x = 343
integer y = 1576
integer width = 325
integer height = 68
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_residente.rowcount() 
	idw_residente.SetItem(i,'activo','N')
next
end event

type cb_todos5 from commandbutton within tabpage_10
boolean visible = false
integer x = 14
integer y = 1576
integer width = 325
integer height = 68
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_residente.rowcount() 
	idw_residente.SetItem(i,'activo','S')
next
end event

type gb_15 from groupbox within tabpage_10
integer x = 9
integer y = 48
integer width = 846
integer height = 1508
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Residente"
end type

type tabpage_11 from userobject within tab_1
event create ( )
event destroy ( )
boolean visible = false
integer x = 18
integer y = 184
integer width = 2642
integer height = 2040
long backcolor = 79741120
string text = "Hon. Orien."
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
cb_todos6 cb_todos6
cb_borrar6 cb_borrar6
dw_honos_tarifas dw_honos_tarifas
dw_opcion_tarifa dw_opcion_tarifa
gb_16 gb_16
end type

on tabpage_11.create
this.cb_todos6=create cb_todos6
this.cb_borrar6=create cb_borrar6
this.dw_honos_tarifas=create dw_honos_tarifas
this.dw_opcion_tarifa=create dw_opcion_tarifa
this.gb_16=create gb_16
this.Control[]={this.cb_todos6,&
this.cb_borrar6,&
this.dw_honos_tarifas,&
this.dw_opcion_tarifa,&
this.gb_16}
end on

on tabpage_11.destroy
destroy(this.cb_todos6)
destroy(this.cb_borrar6)
destroy(this.dw_honos_tarifas)
destroy(this.dw_opcion_tarifa)
destroy(this.gb_16)
end on

type cb_todos6 from commandbutton within tabpage_11
boolean visible = false
integer x = 14
integer y = 1576
integer width = 325
integer height = 68
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Sel. Todos"
end type

event clicked;int i

for i=1 to idw_tarifas.rowcount() 
	idw_tarifas.SetItem(i,'activo','S')
next
end event

type cb_borrar6 from commandbutton within tabpage_11
boolean visible = false
integer x = 343
integer y = 1576
integer width = 325
integer height = 68
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
string text = "Borrar Todos"
end type

event clicked;int i

for i=1 to idw_tarifas.rowcount() 
	idw_tarifas.SetItem(i,'activo','N')
next
end event

type dw_honos_tarifas from u_dw within tabpage_11
boolean visible = false
integer x = 41
integer y = 280
integer width = 2350
integer height = 1256
integer taborder = 10
string dataobject = "d_fases_consulta_honos_orientativos"
boolean border = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;string opcion

opcion = dw_opcion_tarifa.GetItemString(1,'opcion')
if opcion='%' then dw_opcion_tarifa.SetItem(1,'opcion','S')
end event

type dw_opcion_tarifa from u_dw within tabpage_11
integer x = 78
integer y = 128
integer width = 736
integer height = 112
integer taborder = 10
string dataobject = "d_colegiados_consulta_opciones"
boolean vscrollbar = false
boolean border = false
boolean livescroll = false
borderstyle borderstyle = stylebox!
boolean ib_isupdateable = false
boolean ib_rmbmenu = false
boolean ib_rmbfocuschange = false
end type

event itemchanged;call super::itemchanged;if data ='S' then
	cb_todos6.visible=true
	cb_borrar6.visible=true
	dw_honos_tarifas.visible = true
else
	cb_todos6.visible=false
	cb_borrar6.visible=false
	dw_honos_tarifas.visible=false
end if 
end event

type gb_16 from groupbox within tabpage_11
integer x = 9
integer y = 48
integer width = 2400
integer height = 1508
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "MS Sans Serif"
long textcolor = 8388608
long backcolor = 67108864
string text = "Tarifa"
end type

type cb_1 from commandbutton within w_fases_listados
boolean visible = false
integer x = 3657
integer y = 28
integer width = 507
integer height = 100
integer taborder = 60
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Formato Consejo"
end type

event clicked;string nombre_fich, ruta

GetFileSaveName("Nombre del fichero para el Consejo", nombre_fich, ruta, &
   '.xls', 'Ficheros EXCEL (*.XLS),*.XLS,')
dw_1.saveas(trim(nombre_fich), HTMLTable!, false)

cb_1.visible = false
end event

